import{c as I,r as a,j as e,A as h,P as u,L,y as l}from"./index-BOrxGUId.js";import{P as D,I as o}from"./cardManagement-BWB-jZph.js";import{c as _}from"./students-BBi51PYW.js";import"./map-pin-Dcb-q0g6.js";import"./index-AuXq6F2_.js";import"./designerUtils-DhCLfHKf.js";import"./refresh-cw-uuKOVddp.js";import"./circle-check-P8qGE_TR.js";const H=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]],O=I("flip-horizontal",H);const A=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],K=I("x",A),Y=({data:r,layout:i,onClose:f})=>{const[M,q]=a.useState(1),[c,R]=a.useState(!1),[b,S]=a.useState(""),[v,T]=a.useState(""),[d,j]=a.useState(!0),[p,y]=a.useState(0),[x,N]=a.useState(0),[m,w]=a.useState(0),[g,k]=a.useState(0),C=[{label:"None",values:{top:0,bottom:0,left:0,right:0}},{label:"5px",values:{top:5,bottom:5,left:5,right:5}},{label:"10px",values:{top:10,bottom:10,left:10,right:10}}],B=t=>{y(t.values.top),N(t.values.bottom),w(t.values.left),k(t.values.right)};a.useEffect(()=>{(async()=>{j(!0),await new Promise(s=>setTimeout(s,2e3));try{const s=document.querySelector("#front-print-stage canvas"),n=document.querySelector("#back-print-stage canvas");s&&n?(S(s.toDataURL("image/png",1)),T(n.toDataURL("image/png",1))):console.error("Konva canvas not found in DOM")}catch(s){console.error("Capture error:",s),l.error("Failed to capture high-res ID images")}finally{j(!1)}})()},[r,i]);const E=async()=>{if(!b||!v){l.error("Processing images, please wait...");return}if((()=>{const s=window;return!!(s.process&&s.process.type)||!!(s.navigator&&s.navigator.userAgent.includes("Electron"))})())try{await _(r.id);const n=window.require("electron").ipcRenderer;n.send("print-card-images",{frontImage:b,backImage:v,width:h,height:u,margins:{top:p,bottom:x,left:m,right:g}}),n.once("print-reply",($,P)=>{P.success?(l.success("Sent to printer successfully"),setTimeout(f,1e3)):l.error(`Print Error: ${P.failureReason}`)})}catch{l.error("Connection to local print service failed.")}else window.print()},z=h+m+g,F=u+p+x;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 0; size: 2.125in 3.375in portrait; }
          body * { visibility: hidden; }
          #print-root, #print-root * { visibility: visible; }
          #print-root { position: absolute; left: 0; top: 0; width: 100%; }
          .print-page {
            width: 2.125in !important;
            height: 3.375in !important;
            page-break-after: always !important;
            display: flex;
            align-items: center;
            justify-content: center;
          }
        }
        .hidden-stage { position: absolute; left: -9999px; top: -9999px; }
        .blueprint-bg {
          background-color: #0f172a;
          background-image: radial-gradient(#334155 1px, transparent 1px);
          background-size: 20px 20px;
        }
      `}),e.jsxs("div",{className:"fixed inset-0 z-[100] flex bg-slate-950 text-slate-200",children:[e.jsxs("aside",{className:"w-96 h-full bg-slate-900 border-r border-slate-800 flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center",children:[e.jsx("h2",{className:"font-bold text-white",children:"Print Terminal"}),e.jsx("button",{onClick:f,className:"hover:bg-slate-800 p-1 rounded",children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Printer Offsets (Fine-tuning)"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:C.map(t=>e.jsx("button",{onClick:()=>B(t),className:"text-[10px] py-1 bg-slate-800 rounded",children:t.label},t.label))}),[{l:"Top",v:p,s:y},{l:"Right",v:g,s:k},{l:"Bottom",v:x,s:N},{l:"Left",v:m,s:w}].map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[11px] mb-1",children:[e.jsxs("span",{children:[t.l," Offset"]}),e.jsxs("span",{children:[t.v,"px"]})]}),e.jsx("input",{type:"range",min:"-50",max:"50",value:t.v,onChange:s=>t.s(Number(s.target.value)),className:"w-full accent-teal-500"})]},t.l))]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Back Side Orientation"}),e.jsxs("button",{onClick:()=>R(!c),className:`w-full p-3 rounded-lg border-2 flex items-center gap-3 transition-all ${c?"border-teal-500 bg-teal-500/10":"border-slate-700"}`,children:[e.jsx(O,{size:18}),e.jsx("span",{className:"text-sm",children:"Mirror Back Image"})]})]}),e.jsxs("div",{className:"p-4 bg-slate-950 rounded border border-slate-800 text-[11px] font-mono space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-slate-500",children:[e.jsx("span",{children:"Target Res:"}),e.jsxs("span",{children:[h,"x",u]})]}),e.jsxs("div",{className:"flex justify-between text-teal-400",children:[e.jsx("span",{children:"Final Feed:"}),e.jsxs("span",{children:[z,"x",F]})]})]})]}),e.jsx("div",{className:"p-6 bg-slate-950 border-t border-slate-800 space-y-3",children:e.jsxs("button",{disabled:d,onClick:E,className:"w-full py-4 bg-teal-500 hover:bg-teal-400 disabled:bg-slate-700 text-slate-950 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg shadow-teal-500/20",children:[d?e.jsx(L,{className:"animate-spin"}):e.jsx(D,{size:20}),d?"Rasterizing ID...":"EXECUTE PRINT"]})})]}),e.jsx("main",{className:"flex-1 blueprint-bg flex items-center justify-center p-12 overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-8 transition-all duration-500",style:{transform:`scale(${M})`},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{data:r,layout:i,side:"FRONT",scale:1,isPrinting:!1}),e.jsx("p",{className:"text-center text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Front Perspective"})]}),e.jsxs("div",{className:"space-y-2",style:{transform:c?"scaleX(-1)":"none"},children:[e.jsx(o,{data:r,layout:i,side:"BACK",scale:1,isPrinting:!1}),e.jsx("p",{className:"text-center text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Back Perspective"})]})]})})]}),e.jsxs("div",{className:"hidden-stage",children:[e.jsx("div",{id:"front-print-stage",children:e.jsx(o,{data:r,layout:i,side:"FRONT",isPrinting:!0})}),e.jsx("div",{id:"back-print-stage",children:e.jsx(o,{data:r,layout:i,side:"BACK",isPrinting:!0})})]})]})};export{Y as default};
