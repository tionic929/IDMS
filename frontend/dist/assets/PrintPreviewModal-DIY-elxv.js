import{c as d,r as i,j as e,ad as q,A as N,P as k,y as n}from"./index-ctC3Ugkw.js";import{P as H,I as c}from"./cardManagement-xnE7dIRA.js";import{c as G}from"./students-CkwbEya-.js";import{D as K}from"./download-Dp3Yu4Zk.js";import"./map-pin-CpCkBlaX.js";import"./index-djB_fYzu.js";import"./designerUtils-BK4WtPRD.js";import"./refresh-cw-B5oPgGpd.js";import"./circle-check-CoPv5K_q.js";const Z=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]],W=d("flip-horizontal",Z);const X=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],U=d("info",X);const J=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Q=d("scissors",J);const V=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Y=d("x",V);const ee=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],se=d("zoom-in",ee);const te=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ae=d("zoom-out",te),ue=({data:t,layout:l,onClose:w})=>{const[m,y]=i.useState(1.2),[x,R]=i.useState(!1),[p,T]=i.useState(!1),[u,$]=i.useState(""),[g,B]=i.useState(""),[h,P]=i.useState(!0),[b,M]=i.useState(0),[f,I]=i.useState(0),[j,S]=i.useState(0),[v,C]=i.useState(0),D=[{label:"None",values:{top:0,bottom:0,left:0,right:0}},{label:"5px",values:{top:5,bottom:5,left:5,right:5}},{label:"10px",values:{top:10,bottom:10,left:10,right:10}},{label:"15px",values:{top:15,bottom:15,left:15,right:15}}],L=s=>{M(s.values.top),I(s.values.bottom),S(s.values.left),C(s.values.right)};i.useEffect(()=>{P(!0);const s=setTimeout(()=>{const a=document.querySelector("#front-print-stage canvas"),o=document.querySelector("#back-print-stage canvas");a&&$(a.toDataURL("image/png",1)),o&&B(o.toDataURL("image/png",1)),P(!1)},1e3);return()=>clearTimeout(s)},[t,l]);const E=()=>{if(!u||!g){n.error("Images not ready. Please wait...");return}const s=document.createElement("a");s.download=`${t.idNumber}_FRONT.png`,s.href=u,s.click(),setTimeout(()=>{const a=document.createElement("a");a.download=`${t.idNumber}_BACK.png`,a.href=g,a.click()},300),n.success("High-resolution images downloaded!")},F=async()=>{if(!u||!g){n.error("Images still processing...");return}const a=(()=>{const r=window;return!!(r.process&&r.process.type)||!!(r.navigator&&r.navigator.userAgent.includes("Electron"))})(),o=window;if(a&&typeof o.require<"u")try{await G(t.id);const z=o.require("electron").ipcRenderer;n.info("Sending to local printer service..."),z.send("print-card-images",{frontImage:u,backImage:g,width:N,height:k,margins:{top:b,bottom:f,left:j,right:v}}),z.once("print-reply",(ie,_)=>{_.success?(n.success("Print job completed successfully!"),setTimeout(w,1500)):n.error(`Print failed: ${_.failureReason}`)})}catch(r){console.error("Print error:",r),n.error("Local printing failed. The Python service might be offline.")}else n.warn("Silent printing requires the Desktop App. Opening browser print..."),window.print()},A=N+j+v,O=k+b+f;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @media print {
          @page { margin: 0; size: 2.125in 3.375in portrait; }
          body, html { margin: 0 !important; padding: 0 !important; background: white !important; }
          body * { visibility: hidden; }
          #print-root, #print-root * { visibility: visible; }
          #print-root { position: absolute; left: 0; top: 0; width: 100%; }
          .print-page {
            width: 2.125in !important;
            height: 3.375in !important;
            page-break-after: always !important;
            page-break-inside: avoid !important;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
          }
        }
        .hidden-canvas { position: absolute; left: -9999px; top: -9999px; pointer-events: none; }
        .blueprint-grid {
          background-color: #0f172a;
          background-size: 30px 30px;
          background-image: 
            linear-gradient(to right, rgba(100, 116, 139, 0.1) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(100, 116, 139, 0.1) 1px, transparent 1px);
        }
        .cut-guides::before {
          content: ''; position: absolute; inset: -12px;
          border: 2px dashed #14b8a6; border-radius: 4px; pointer-events: none;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
      `}),e.jsxs("div",{className:"fixed inset-0 z-[100] flex bg-slate-950 text-slate-200 overflow-hidden",children:[e.jsxs("aside",{className:"w-[30vw] h-full bg-slate-900 border-r border-slate-800 flex flex-col shrink-0 shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Print Settings"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:t.idNumber})]}),e.jsx("button",{onClick:w,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(Y,{size:18,className:"text-slate-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Preview Zoom"}),e.jsxs("span",{className:"text-sm font-mono font-semibold text-teal-400",children:[Math.round(m*100),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>y(Math.max(.3,m-.1)),className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(ae,{size:14,className:"text-slate-400"})}),e.jsx("input",{type:"range",min:"0.3",max:"1.5",step:"0.1",value:m,onChange:s=>y(parseFloat(s.target.value)),className:"flex-1 h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-teal-500"}),e.jsx("button",{onClick:()=>y(Math.min(1.5,m+.1)),className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(se,{size:14,className:"text-slate-400"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Display Options"}),e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsx("button",{onClick:()=>R(!x),className:`w-full flex items-center justify-between p-3 rounded-lg border-2 transition-all ${x?"border-teal-500 bg-teal-500/10":"border-slate-700 hover:border-slate-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{size:16,className:x?"text-teal-400":"text-slate-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Cut Guides"})]})}),e.jsx("button",{onClick:()=>T(!p),className:`w-full flex items-center justify-between p-3 rounded-lg border-2 transition-all ${p?"border-teal-500 bg-teal-500/10":"border-slate-700 hover:border-slate-600"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{size:16,className:p?"text-teal-400":"text-slate-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Mirror Back"})]})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("span",{className:"flex flex-row justify-between items-center text-xs font-semibold text-slate-400 uppercase tracking-wider",children:["Margin Settings ",e.jsx(q,{size:14,className:"text-slate-500"})]}),e.jsxs("div",{className:"p-3 bg-slate-950/50 rounded-lg border border-slate-800 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-2",children:D.map(s=>e.jsx("button",{onClick:()=>L(s),className:"py-2 px-3 text-xs font-medium bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",children:s.label},s.label))}),[{label:"Top",value:b,setter:M},{label:"Right",value:v,setter:C},{label:"Bottom",value:f,setter:I},{label:"Left",value:j,setter:S}].map(({label:s,value:a,setter:o})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1.5",children:[e.jsx("span",{className:"font-medium text-slate-400",children:s}),e.jsxs("span",{className:"font-semibold text-teal-400",children:[a,"px"]})]}),e.jsx("input",{type:"range",min:"0",max:"50",value:a,onChange:r=>o(Number(r.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-teal-500"})]},s))]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-indigo-500/10 border border-indigo-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 mb-2",children:[e.jsx(U,{size:14}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider",children:"Output Specs"})]}),e.jsxs("div",{className:"space-y-1 text-xs text-slate-400",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Resolution:"}),e.jsxs("span",{className:"font-mono text-slate-300",children:[N,"×",k,"px"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"DPI:"}),e.jsx("span",{className:"font-mono text-slate-300",children:"300"})]}),b+f+j+v>0&&e.jsxs("div",{className:"flex justify-between pt-2 border-t border-indigo-500/20",children:[e.jsx("span",{children:"With Margins:"}),e.jsxs("span",{className:"font-mono text-slate-300",children:[A,"×",O,"px"]})]})]})]})]}),e.jsxs("div",{className:"p-6 bg-slate-950 border-t border-slate-800 space-y-3",children:[e.jsxs("button",{onClick:E,disabled:h,className:"w-full py-3 px-4 bg-slate-800 hover:bg-slate-700 text-white rounded-lg font-semibold text-sm transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(K,{size:16})," ",h?"Processing...":"Download Images"]}),e.jsxs("button",{onClick:F,disabled:h,className:"w-full py-3 px-4 bg-teal-500 hover:bg-teal-400 text-slate-950 rounded-lg font-semibold text-sm transition-all disabled:opacity-50 flex items-center justify-center gap-2 shadow-lg shadow-teal-500/20",children:[e.jsx(H,{size:16})," ",h?"Processing...":"Print Cards"]})]})]}),e.jsx("main",{className:"flex-1 blueprint-grid relative flex items-center justify-center overflow-auto p-12 custom-scrollbar",children:e.jsxs("div",{className:"flex flex-col xl:flex-row gap-12 transition-transform duration-300 ease-out",style:{transform:`scale(${m})`},children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:`shadow-2xl rounded-sm overflow-hidden ${x?"cut-guides":""}`,children:e.jsx(c,{data:t,layout:l,side:"FRONT",scale:1,isPrinting:!1})}),e.jsx("div",{className:"px-4 py-1.5 rounded-full bg-slate-800/80 backdrop-blur-sm border border-slate-700",children:e.jsx("span",{className:"text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Front Side"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:`shadow-2xl rounded-sm overflow-hidden ${x?"cut-guides":""}`,style:{transform:p?"scaleX(-1)":"none"},children:e.jsx(c,{data:t,layout:l,side:"BACK",scale:1,isPrinting:!1})}),e.jsx("div",{className:"px-4 py-1.5 rounded-full bg-slate-800/80 backdrop-blur-sm border border-slate-700",children:e.jsx("span",{className:"text-xs font-semibold text-slate-300 uppercase tracking-wider",children:"Back Side"})})]})]})})]}),e.jsxs("div",{className:"hidden-canvas",children:[e.jsx("div",{id:"front-print-stage",children:e.jsx(c,{data:t,layout:l,side:"FRONT",scale:1,isPrinting:!0})}),e.jsx("div",{id:"back-print-stage",children:e.jsx(c,{data:t,layout:l,side:"BACK",scale:1,isPrinting:!0})})]}),e.jsxs("div",{id:"print-root",className:"print-only",children:[e.jsx("div",{className:"print-page",children:e.jsx(c,{data:t,layout:l,side:"FRONT",scale:1,isPrinting:!0})}),e.jsx("div",{className:"print-page",style:{transform:p?"scaleX(-1)":"none"},children:e.jsx(c,{data:t,layout:l,side:"BACK",scale:1,isPrinting:!0})})]})]})};export{ue as default};
