import{S as Ve,s as Ue,h as fe,g as Ke,n as Ne,u as ke,r as x,a as He,b as Xe,c as C,j as e,d as H,L as oe,y as L,C as Ce,U as Qe,e as Ye,f as Ze}from"./index-4zgVIWjI.js";import{u as Se}from"./useQuery-CLPLgxl9.js";import{X as Je}from"./x-oAhOpLLn.js";import{T as ue,E as ge,D as et,r as tt,a as P,b as A,M as ce,c as le,S as de,u as K,G as be,R as re,I as Ee,C as st,d as nt,e as it,f as at,L as ot,g as ye,h as rt,i as ct}from"./index-Cjq1f16C.js";import{D as lt}from"./download-CTqtr0jG.js";import{R as dt}from"./refresh-cw-CB2mE6wQ.js";import{E as ht,A as xt}from"./eye-DxwWOt7g.js";import{g as ut}from"./students-BY22yKxO.js";import{C as pt}from"./chevron-left-eH1qc8EN.js";var mt=class extends Ve{#t;#n=void 0;#e;#s;constructor(s,t){super(),this.#t=s,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#t.defaultMutationOptions(s),Ue(this.options,t)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&fe(t.mutationKey)!==fe(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#i(),this.#a(s)}getCurrentResult(){return this.#n}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#a()}mutate(s,t){return this.#s=t,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(s)}#i(){const s=this.#e?.state??Ke();this.#n={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#a(s){Ne.batch(()=>{if(this.#s&&this.hasListeners()){const t=this.#n.variables,i=this.#n.context,c={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(s?.type==="success"){try{this.#s.onSuccess?.(s.data,t,i,c)}catch(o){Promise.reject(o)}try{this.#s.onSettled?.(s.data,null,t,i,c)}catch(o){Promise.reject(o)}}else if(s?.type==="error"){try{this.#s.onError?.(s.error,t,i,c)}catch(o){Promise.reject(o)}try{this.#s.onSettled?.(void 0,s.error,t,i,c)}catch(o){Promise.reject(o)}}}this.listeners.forEach(t=>{t(this.#n)})})}};function Y(s,t){const i=ke(),[c]=x.useState(()=>new mt(i,s));x.useEffect(()=>{c.setOptions(s)},[c,s]);const o=x.useSyncExternalStore(x.useCallback(h=>c.subscribe(Ne.batchCalls(h)),[c]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),p=x.useCallback((h,d)=>{c.mutate(h,d).catch(He)},[c]);if(o.error&&Xe(c.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:p,mutateAsync:o.mutate}}const ft=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],gt=C("arrow-down-to-line",ft);const bt=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],yt=C("arrow-down",bt);const vt=[["path",{d:"M5 3h14",key:"7usisc"}],["path",{d:"m18 13-6-6-6 6",key:"1kf1n9"}],["path",{d:"M12 7v14",key:"1akyts"}]],jt=C("arrow-up-to-line",vt);const wt=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],zt=C("box",wt);const Nt=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],kt=C("check",Nt);const Ct=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],he=C("circle",Ct);const St=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],_e=C("copy",St);const Et=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],_t=C("eye-off",Et);const Mt=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],Tt=C("focus",Mt);const Dt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Lt=C("grid-3x3",Dt);const $t=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],It=C("hash",$t);const Rt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],xe=C("image",Rt);const At=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],te=C("layers",At);const Pt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Ot=C("lock-open",Pt);const Gt=[["path",{d:"m12 15 4 4",key:"lnac28"}],["path",{d:"M2.352 10.648a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.029-6.029a1 1 0 1 1 3 3l-6.029 6.029a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.365-6.367A1 1 0 0 0 8.716 4.282z",key:"nlhkjb"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}]],Me=C("magnet",Gt);const Ft=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Te=C("maximize",Ft);const qt=[["path",{d:"M5 12h14",key:"1ays0h"}]],Wt=C("minus",qt);const Bt=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],De=C("mouse-pointer-2",Bt);const Vt=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Le=C("move",Vt);const Ut=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Kt=C("palette",Ut);const Ht=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],$e=C("panels-top-left",Ht);const Xt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ie=C("pen-line",Xt);const Qt=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Yt=C("pen-tool",Qt);const Zt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Re=C("plus",Zt);const Jt=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],es=C("rotate-cw",Jt);const ts=[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]],ss=C("ruler",ts);const ns=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],is=C("save",ns);const as=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],os=C("triangle-alert",as);const rs=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],se=C("type",rs),ve=({isOpen:s,onClose:t,title:i,children:c,footer:o,size:p="md"})=>{if(x.useEffect(()=>{const d=v=>{v.key==="Escape"&&t()};return s&&window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[s,t]),!s)return null;const h={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl",full:"max-w-[95vw]"};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity",onClick:t}),e.jsxs("div",{className:`relative w-full ${h[p]} bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in fade-in zoom-in duration-200`,children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-800 flex items-center justify-between bg-zinc-900/50",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-black uppercase text-zinc-100 tracking-widest",children:i})}),e.jsx("button",{onClick:t,className:"p-1.5 hover:bg-zinc-800 rounded-lg text-zinc-500 hover:text-zinc-200 transition-colors",children:e.jsx(Je,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar text-zinc-300",children:c}),o&&e.jsx("div",{className:"px-6 py-4 border-t border-zinc-800 bg-zinc-950/50 flex justify-end gap-3",children:o})]})]})},cs=async()=>(await H.get("/card-layouts")).data,ls=async s=>(await H.post("/card-layouts",{name:s,front_config:{photo:{x:60,y:80,width:200,height:180},fullName:{x:20,y:300,fontSize:22,fill:"#fffff",fontStyle:"bold"},course:{x:20,y:180,fontSize:14,text:s.toUpperCase(),fontStyle:"bold",fill:"#fffff"},idNumber:{x:20,y:330,fontSize:16,fill:"#fffff"}},back_config:{signature:{x:60,y:50,width:200,height:100},address:{x:20,y:210,fontSize:12},guardian_name:{x:20,y:240,fontSize:12},guardian_contact:{x:20,y:260,fontSize:12}}})).data,ds=async s=>(await H.delete(`/card-layouts/${s}`)).data,hs=async s=>(await H.post(`/card-layouts/${s}/duplicate`)).data,Ae=async(s,t,i,c=[])=>(await H.put(`/card-layouts/${s}`,{name:t,front_config:i.front,back_config:i.back,preview_images:c})).data,xs=({onSelect:s,activeId:t,refreshTrigger:i,isCollapsed:c})=>{const o=ke(),[p,h]=x.useState(null),[d,v]=x.useState(null),[w,j]=x.useState(""),{data:y=[],isLoading:k}=Se({queryKey:["templates",i],queryFn:cs,staleTime:120*1e3,refetchOnWindowFocus:!1}),b=Y({mutationFn:ls,onMutate:async f=>{await o.cancelQueries({queryKey:["templates"]});const S=o.getQueryData(["templates"]);return o.setQueryData(["templates",i],(E=[])=>[{id:Date.now(),name:f,is_active:!1,front_config:{},back_config:{}},...E]),{previousTemplates:S}},onError:(f,S,E)=>{o.setQueryData(["templates",i],E?.previousTemplates),L.error("Error creating template")},onSuccess:f=>{L.success("Template created!"),n()},onSettled:()=>{o.invalidateQueries({queryKey:["templates"]})}}),m=Y({mutationFn:async({id:f,name:S,config:E})=>Ae(f,S,E),onSuccess:()=>{o.invalidateQueries({queryKey:["templates"]}),L.success("Template renamed"),n()},onError:()=>{L.error("Failed to rename")}}),l=Y({mutationFn:ds,onMutate:async f=>{await o.cancelQueries({queryKey:["templates"]});const S=o.getQueryData(["templates"]);return o.setQueryData(["templates",i],(E=[])=>E.filter($=>$.id!==f)),{previousTemplates:S}},onError:(f,S,E)=>{o.setQueryData(["templates",i],E?.previousTemplates),L.error("Error deleting template")},onSuccess:()=>{L.success("Template deleted"),n()},onSettled:()=>{o.invalidateQueries({queryKey:["templates"]})}}),r=Y({mutationFn:hs,onSuccess:f=>{o.invalidateQueries({queryKey:["templates"]}),L.success("Template duplicated")},onError:()=>{L.error("Failed to duplicate")}}),n=()=>{h(null),v(null),j("")},a=()=>{w.trim()&&b.mutate(w)},u=()=>{if(!d||!w.trim()||w===d.name){n();return}m.mutate({id:d.id,name:w,config:{front:d.front_config,back:d.back_config}})},N=()=>{d&&l.mutate(d.id)},z=(f,S)=>{f.stopPropagation(),r.mutate(S)},T=b.isPending||m.isPending||l.isPending;return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-900 overflow-hidden",children:[e.jsxs("div",{className:`p-4 border-b border-zinc-800 flex items-center transition-all duration-300 ${c?"justify-center":"justify-between"}`,children:[e.jsxs("div",{className:`flex flex-col transition-all duration-300 origin-left ${c?"w-0 opacity-0 scale-x-0":"w-auto opacity-100 scale-x-100"}`,children:[e.jsx("h3",{className:"text-[11px] font-black uppercase text-zinc-100 tracking-wider whitespace-nowrap",children:"Library"}),e.jsx("p",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tight whitespace-nowrap",children:"Templates"})]}),e.jsx("button",{onClick:()=>{j(""),h("create")},className:"p-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md transition-all shadow-lg shadow-indigo-500/20 shrink-0","aria-label":"Create new template",children:e.jsx(Re,{size:16})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:k?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 opacity-20",children:[e.jsx(oe,{size:18,className:"animate-spin text-zinc-400"}),!c&&e.jsx("p",{className:"text-[9px] text-zinc-500 mt-2 uppercase font-bold",children:"Loading..."})]}):y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center px-4",children:[e.jsx($e,{size:32,className:"text-zinc-700 mb-2"}),!c&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[10px] text-zinc-500 font-bold uppercase",children:"No Templates"}),e.jsx("p",{className:"text-[9px] text-zinc-600 mt-1",children:"Create your first template"})]})]}):y.map(f=>e.jsx("div",{onClick:()=>s(f),className:`group relative rounded-lg border transition-all duration-300 cursor-pointer overflow-hidden ${c?"p-2":"p-3"} ${t===f.id?"bg-indigo-500/10 border-indigo-500/50":"bg-transparent border-transparent hover:bg-zinc-800"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-md shrink-0 transition-colors ${t===f.id?"bg-indigo-500 text-white":"bg-zinc-950 text-zinc-600 group-hover:text-zinc-400"}`,children:e.jsx(te,{size:14})}),e.jsxs("div",{className:`flex flex-col text-left transition-all duration-300 origin-left overflow-hidden ${c?"w-0 opacity-0 scale-x-0 invisible":"w-full opacity-100 scale-x-100 visible"}`,children:[e.jsx("h4",{className:`text-[11px] font-bold truncate whitespace-nowrap ${t===f.id?"text-indigo-400":"text-zinc-300"}`,children:f.name}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsxs("span",{className:"text-[8px] font-mono text-zinc-600 uppercase",children:["ID: ",f.id]}),f.is_active&&e.jsx("span",{className:"text-[7px] bg-emerald-500/10 text-emerald-500 px-1 rounded font-black uppercase",children:"Active"})]})]}),!c&&e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-all duration-200 shrink-0",children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),v(f),j(f.name),h("rename")},className:"p-1 hover:bg-zinc-700 rounded text-zinc-500 hover:text-zinc-100 transition-colors","aria-label":"Rename template",children:e.jsx(Ie,{size:11})}),e.jsx("button",{onClick:S=>z(S,f.id),className:"p-1 hover:bg-zinc-700 rounded text-zinc-500 hover:text-zinc-100 transition-colors",disabled:r.isPending,"aria-label":"Duplicate template",children:e.jsx(_e,{size:11})}),e.jsx("button",{onClick:S=>{S.stopPropagation(),v(f),h("delete")},className:"p-1 hover:bg-red-500/10 rounded text-zinc-500 hover:text-red-500 transition-colors","aria-label":"Delete template",children:e.jsx(ue,{size:11})})]})]})},f.id))}),e.jsx(ve,{isOpen:p==="create"||p==="rename",onClose:n,title:p==="create"?"New Template":"Rename Template",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-[10px] font-black uppercase text-zinc-500 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p==="create"?a:u,disabled:T||!w.trim(),className:"px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md text-[10px] font-black uppercase tracking-widest disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:T?e.jsx(oe,{size:14,className:"animate-spin"}):"Confirm"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-zinc-500 tracking-widest",children:"Display Name"}),e.jsx("input",{autoFocus:!0,type:"text",value:w,onChange:f=>j(f.target.value),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg p-3 text-sm text-zinc-200 focus:outline-none focus:border-indigo-500 transition-colors",onKeyDown:f=>{f.key==="Enter"&&w.trim()&&(p==="create"?a():u())},placeholder:"Enter template name..."})]})}),e.jsx(ve,{isOpen:p==="delete",onClose:n,title:"Delete Template",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-[10px] font-black uppercase text-zinc-500 hover:text-white transition-colors",children:"Go Back"}),e.jsx("button",{onClick:N,disabled:T,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md text-[10px] font-black uppercase tracking-widest disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:T?e.jsx(oe,{size:14,className:"animate-spin"}):"Delete Permanently"})]}),children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4 py-2",children:[e.jsx("div",{className:"p-3 bg-red-500/10 text-red-500 rounded-full",children:e.jsx(os,{size:32})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-zinc-300",children:["Delete ",e.jsxs("span",{className:"text-white font-bold",children:['"',d?.name,'"']}),"?"]}),e.jsx("p",{className:"text-xs text-zinc-500 mt-2",children:"This action cannot be undone"})]})]})})]})},Pe=x.createContext(void 0),us=({children:s,templateId:t,templateName:i,currentLayout:c,onSave:o})=>{const[p,h]=x.useState("FRONT"),[d,v]=x.useState(c),[w,j]=x.useState(!1);x.useEffect(()=>{c&&v(c)},[c]);const y=d[p.toLowerCase()]||{},k=x.useCallback((r,n)=>{const a=p.toLowerCase();v(u=>({...u,[a]:{...u[a],[r]:{...u[a][r],...n}}}))},[p]),b=x.useCallback(async r=>{if(!t){L.error("Select a template");return}if(!r?.current){L.error("Canvas not ready");return}j(!0);const n=p;try{const a=async T=>(h(T),await new Promise(f=>setTimeout(f,150)),r.current?.toDataURL({pixelRatio:ge})),u=await a("FRONT"),N=await a("BACK"),z={...d,previewImages:{front:u,back:N}};await Ae(t,i,z),o(z),h(n),L.success("Changes saved!")}catch(a){console.error("Save error:",a),L.error("Save failed"),h(n)}finally{j(!1)}},[t,i,d,o,p]),m=x.useCallback((r,n)=>{r?.current&&setTimeout(()=>{const a=r.current.toDataURL({pixelRatio:ge}),u=document.createElement("a");u.download=`${n?.idNumber||"ID"}_${p}.png`,u.href=a,u.click(),L.success(`Exported ${p} side`)},50)},[p]),l={templateId:t,templateName:i,editSide:p,setEditSide:h,tempLayout:d,setTempLayout:v,currentSideData:y,isSaving:w,handleSave:b,handleExport:m,onSave:o,updateItem:k};return e.jsx(Pe.Provider,{value:l,children:s})},q=()=>{const s=x.useContext(Pe);if(!s)throw new Error("useDesignerContext must be used within DesignerProvider");return s},Oe=x.createContext(void 0),ps=({children:s})=>{const[t,i]=x.useState(et),[c,o]=x.useState(!0),[p,h]=x.useState("select"),[d,v]=x.useState(!0),[w,j]=x.useState("both"),[y,k]=x.useState("px"),[b,m]=x.useState(!0),[l,r]=x.useState({vertical:[],horizontal:[]}),[n,a]=x.useState(!1),u={zoom:t,setZoom:i,showGrid:c,setShowGrid:o,activeTool:p,setActiveTool:h,snapEnabled:d,setSnapEnabled:v,snapMode:w,setSnapMode:j,gridUnit:y,setGridUnit:k,showSnapGuides:b,setShowSnapGuides:m,snapLines:l,setSnapLines:r,isTransforming:n,setIsTransforming:a};return e.jsx(Oe.Provider,{value:u,children:s})},X=()=>{const s=x.useContext(Oe);if(!s)throw new Error("useCanvasContext must be used within CanvasProvider");return s},Ge=x.createContext(void 0),ms=({children:s})=>{const{editSide:t,tempLayout:i,setTempLayout:c}=q(),[o,p]=x.useState(null),h=x.useCallback(l=>{const r=t.toLowerCase(),n=`${l}_${Date.now()}`,a={x:50,y:50,width:100,height:100,fill:"#6366f1",rotation:0,opacity:1,type:l,fit:"none",visible:!0};c(u=>({...u,[r]:{...u[r],[n]:a}})),p(n)},[t,c]),d=x.useCallback(()=>{const l=t.toLowerCase(),r=`text_${Date.now()}`,n={type:"text",x:50,y:50,width:200,height:40,text:"New Text",fontSize:20,fill:"#000000",rotation:0,fit:"none",visible:!0};c(a=>({...a,[l]:{...a[l],[r]:n}})),p(r)},[t,c]),v=x.useCallback(l=>{if(!l)return;const r=new FileReader;r.onload=n=>{const a=n.target?.result,u=new Image;u.onload=()=>{const N=t.toLowerCase(),z=`img_${Date.now()}`,T=u.height/u.width,f=Math.min(A*.4,200),S=f*T,E={type:"image",src:a,x:(A-f)/2,y:(P-S)/2,width:Math.round(f),height:Math.round(S),opacity:1,rotation:0,visible:!0};c($=>({...$,[N]:{...$[N],[z]:E}})),p(z),L.success("Image uploaded")},u.src=a},r.readAsDataURL(l)},[t,c]),w=x.useCallback(l=>{const r=l||o;if(!r)return;const n=t.toLowerCase(),a={...i};delete a[n][r],c(a),r===o&&p(null)},[o,t,i,c]),j=x.useCallback(l=>{const r=t.toLowerCase(),n=i[r][l];if(!n)return;const a=`${n.type||"copy"}_${Date.now()}`,u={...n,x:n.x+20,y:n.y+20,visible:!0};c(N=>{const z=N[r],T={};return Object.keys(z).forEach(f=>{T[f]=z[f],f===l&&(T[a]=u)}),{...N,[r]:T}}),p(a)},[t,i,c]),y=x.useCallback((l,r)=>{if(!r||l===r)return;const n=t.toLowerCase();c(a=>{const u={};return Object.keys(a[n]).forEach(N=>{N===l?u[r]={...a[n][l]}:u[N]=a[n][N]}),{...a,[n]:u}}),p(r)},[t,c]),k=x.useCallback(l=>{const r=t.toLowerCase();c(n=>({...n,[r]:{...n[r],[l]:{...n[r][l],visible:n[r][l].visible===!1}}}))},[t,c]),b=x.useCallback(l=>{if(!o)return;const r=t.toLowerCase();c(n=>({...n,[r]:tt(n[r],o,l)}))},[o,t,c]),m={selectedId:o,setSelectedId:p,addShape:h,addText:d,handleDelete:w,handleDuplicate:j,handleRename:y,handleToggleVisibility:k,moveLayer:b,handleImageUpload:v};return e.jsx(Ge.Provider,{value:m,children:s})},ne=()=>{const s=x.useContext(Ge);if(!s)throw new Error("useLayerContext must be used within LayerProvider");return s},Z=({icon:s,label:t,active:i,onClick:c,disabled:o})=>e.jsx("button",{onClick:c,disabled:o,title:t,className:`p-2 rounded-lg transition-all flex items-center justify-center ${i?"bg-indigo-500/20 text-indigo-400 border border-indigo-500/50":"text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200 border border-transparent"} ${o?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(s,{size:18,strokeWidth:2})}),fs=({stageRef:s,previewData:t,onRecenter:i})=>{const{templateName:c,isSaving:o,handleSave:p,handleExport:h}=q(),{zoom:d,setZoom:v,snapEnabled:w,setSnapEnabled:j}=X();return e.jsxs("div",{className:"h-14 border-b border-zinc-800 bg-zinc-900 px-6 flex items-center justify-between z-30 shrink-0",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-zinc-500",children:[e.jsx("span",{className:"text-xs font-medium hover:text-zinc-300 cursor-pointer transition-colors",children:"Templates"}),e.jsx(Ce,{size:14}),e.jsx("span",{className:"text-xs font-bold text-zinc-100",children:c})]})}),e.jsxs("div",{className:"flex items-center gap-1 bg-zinc-950/50 p-1 rounded-xl border border-zinc-800/50",children:[e.jsx(Z,{icon:Wt,onClick:()=>v(y=>Math.max(ce,y-.1)),label:"Zoom Out",disabled:d<=ce}),e.jsxs("span",{className:"text-[10px] w-10 text-center font-mono text-zinc-400 font-bold",children:[Math.round(d*100),"%"]}),e.jsx(Z,{icon:Re,onClick:()=>v(y=>Math.min(le,y+.1)),label:"Zoom In",disabled:d>=le}),e.jsx("div",{className:"w-px h-4 bg-zinc-800 mx-1"}),e.jsx(Z,{icon:Te,onClick:()=>{window.dispatchEvent(new CustomEvent("recenter-canvas"))},label:"Recenter View"}),e.jsx("div",{className:"w-px h-4 bg-zinc-800 mx-1"}),e.jsx(Z,{icon:Me,active:w,onClick:()=>j(!w),label:`Snapping ${w?"ON":"OFF"}`})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>h(s,t),className:"flex items-center gap-2 px-3 py-1.5 text-zinc-400 hover:text-zinc-100 text-xs font-semibold transition-all",children:[e.jsx(lt,{size:14}),"Export"]}),e.jsxs("button",{onClick:()=>p(s),disabled:o,className:"flex items-center gap-2 px-4 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-xs font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-900/20",children:[o?e.jsx(dt,{size:14,className:"animate-spin"}):e.jsx(is,{size:14}),o?"Saving...":"Save Design"]})]})]})},V=({icon:s,label:t,active:i,onClick:c})=>e.jsx("button",{onClick:c,title:t,className:`p-2 rounded-lg transition-all flex items-center justify-center ${i?"bg-indigo-500/20 text-indigo-400 border border-indigo-500/50":"text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200 border border-transparent"}`,children:e.jsx(s,{size:18,strokeWidth:2})}),gs=()=>{const{activeTool:s,setActiveTool:t}=X(),{addShape:i,addText:c,handleImageUpload:o}=ne(),p=x.useRef(null),h=d=>{const v=d.target.files?.[0];v&&(o(v),d.target.value="")};return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:p,type:"file",className:"hidden",accept:"image/*",onChange:h}),e.jsxs("div",{className:"w-12 border-r border-zinc-800 bg-zinc-900 flex flex-col items-center py-4 gap-3 z-20 shrink-0",children:[e.jsx(V,{icon:De,active:s==="select",onClick:()=>t("select"),label:"Select"}),e.jsx(V,{icon:Le,active:s==="hand",onClick:()=>t("hand"),label:"Pan"}),e.jsx("div",{className:"w-4 h-px bg-zinc-800"}),e.jsx(V,{icon:de,onClick:()=>i("rect"),label:"Rectangle"}),e.jsx(V,{icon:he,onClick:()=>i("circle"),label:"Circle"}),e.jsx(V,{icon:xe,onClick:()=>p.current?.click(),label:"Upload Image"})]})]})},bs=({layers:s,selectedId:t,onSelect:i,onAddShape:c,onAddText:o,onUploadImage:p,onDuplicate:h,onDelete:d,onToggleVisibility:v,onRename:w})=>{const[j,y]=x.useState(null),[k,b]=x.useState(""),m=(n,a)=>n==="photo"?e.jsx(Qe,{size:12,className:"text-emerald-400"}):n==="signature"?e.jsx(Yt,{size:12,className:"text-amber-400"}):n.startsWith("img")||a==="image"?e.jsx(xe,{size:12,className:"text-indigo-400"}):n.startsWith("rect")?e.jsx(de,{size:12,className:"text-zinc-400"}):n.startsWith("circle")?e.jsx(he,{size:12,className:"text-zinc-400"}):e.jsx(se,{size:12,className:"text-zinc-400"}),l=(n,a)=>{y(n),b(a)},r=n=>{k.trim()&&w(n,k.trim()),y(null)};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-900/90 border-r border-zinc-800 select-none",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-800 bg-zinc-950/20",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-zinc-500 tracking-widest flex items-center gap-2 mb-4",children:[e.jsx(zt,{size:14})," Assets"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{icon:de,label:"Rect",action:()=>c("rect")},{icon:he,label:"Circle",action:()=>c("circle")},{icon:se,label:"Text",action:o},{icon:xe,label:"Image",action:p}].map((n,a)=>e.jsxs("button",{onClick:n.action,className:"flex flex-col items-center justify-center p-3 rounded-xl border border-zinc-800 bg-zinc-900/50 hover:bg-indigo-500/10 hover:border-indigo-500/40 transition-all text-zinc-400 group active:scale-95",children:[e.jsx(n.icon,{size:18,className:"group-hover:text-indigo-400 transition-colors"}),e.jsx("span",{className:"text-[8px] font-black mt-1.5 uppercase tracking-tighter",children:n.label})]},a))})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-zinc-800 bg-zinc-950/40",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-zinc-400 tracking-widest flex items-center gap-2",children:[e.jsx(te,{size:14})," Layers"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-zinc-800 text-[9px] font-mono text-zinc-400",children:Object.keys(s||{}).length})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1",children:[s&&Object.entries(s).reverse().map(([n,a])=>{const u=t===n,N=j===n;return e.jsx("div",{className:"group flex flex-col",children:e.jsxs("div",{onClick:()=>i(n),className:`relative flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all cursor-pointer border ${u?"bg-indigo-500/10 border-indigo-500/30 shadow-[0_0_15px_rgba(99,102,241,0.05)]":"bg-transparent border-transparent hover:bg-zinc-800/50 hover:border-zinc-700/50"}`,children:[e.jsx("div",{className:`${a.visible===!1?"opacity-20":"opacity-60 group-hover:opacity-100"}`,children:m(n,a.type)}),e.jsx("div",{className:"flex-1 min-w-0",children:N?e.jsxs("div",{className:"flex items-center gap-1",onClick:z=>z.stopPropagation(),children:[e.jsx("input",{autoFocus:!0,className:"bg-zinc-950 border border-indigo-500 rounded px-1.5 py-0.5 text-[11px] text-zinc-200 w-full outline-none",value:k,onChange:z=>b(z.target.value),onKeyDown:z=>z.key==="Enter"&&r(n)}),e.jsx("button",{onClick:()=>r(n),className:"text-emerald-500",children:e.jsx(kt,{size:12})})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-[11px] font-bold truncate ${u?"text-indigo-400":"text-zinc-300"} ${a.visible===!1?"text-zinc-600":""}`,children:n.replace(/_/g," ")}),e.jsxs("span",{className:"text-[8px] font-mono text-zinc-600",children:[Math.round(a.x),"x, ",Math.round(a.y),"y"]})]})}),e.jsxs("div",{className:`flex items-center gap-1.5 ${u?"opacity-100":"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[e.jsx("button",{onClick:z=>{z.stopPropagation(),v(n)},className:"p-1 hover:text-white text-zinc-500 transition-colors",title:"Toggle Visibility",children:a.visible!==!1?e.jsx(ht,{size:12}):e.jsx(_t,{size:12,className:"text-zinc-700"})}),u&&!N&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:z=>{z.stopPropagation(),l(n,n)},className:"p-1 hover:text-indigo-400 text-zinc-500 transition-colors",title:"Rename",children:e.jsx(Ie,{size:12})}),e.jsx("button",{onClick:z=>{z.stopPropagation(),h(n)},className:"p-1 hover:text-indigo-400 text-zinc-500 transition-colors",title:"Duplicate",children:e.jsx(_e,{size:12})}),e.jsx("button",{onClick:z=>{z.stopPropagation(),d(n)},className:"p-1 hover:text-red-400 text-zinc-500 transition-colors",title:"Delete",children:e.jsx(ue,{size:12})})]})]})]})},n)}),(!s||Object.keys(s).length===0)&&e.jsxs("div",{className:"py-20 text-center opacity-20",children:[e.jsx(te,{size:32,strokeWidth:1,className:"mx-auto mb-3"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:"Canvas Empty"})]})]})]})]})},ys=()=>{const{editSide:s,setEditSide:t,currentSideData:i}=q(),{selectedId:c,setSelectedId:o,addShape:p,addText:h,handleDuplicate:d,handleDelete:v,handleToggleVisibility:w,handleRename:j,handleImageUpload:y}=ne(),k=x.useRef(null),b=m=>{const l=m.target.files?.[0];l&&(y(l),m.target.value="")};return e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:k,type:"file",className:"hidden",accept:"image/*",onChange:b}),e.jsxs("div",{className:"w-64 border-r border-zinc-800 bg-zinc-900/50 flex flex-col z-10 shrink-0",children:[e.jsx("div",{className:"p-4 border-b border-zinc-800",children:e.jsx("div",{className:"flex bg-zinc-950 p-1 rounded-lg border border-zinc-800",children:["FRONT","BACK"].map(m=>e.jsxs("button",{onClick:()=>{t(m),o(null)},className:`flex-1 py-1.5 rounded-md text-[10px] font-bold transition-all ${s===m?"bg-zinc-800 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,children:[m," SIDE"]},m))})}),e.jsx(bs,{layers:i,selectedId:c,onSelect:o,onAddShape:p,onAddText:h,onUploadImage:()=>k.current?.click(),onDuplicate:d,onDelete:v,onToggleVisibility:w,onRename:j})]})]})},je="https://dashboard-ncnian-id.svizcarra.online",we=s=>{if(!s)return"";if(s.startsWith("http")||s.startsWith("data:")||s.startsWith("blob:"))return s;const t=s.replace(`${je}/storage/`,"");return`${je}/api/proxy-image?path=${encodeURIComponent(t)}`},Fe=(s,t)=>{const{data:i,isLoading:c}=Se({queryKey:["preview-student"],queryFn:async()=>{const p=await ut(),h=[...p.queueList||[],...p.history||[]];return h?.length?[...h].sort((d,v)=>new Date(v.updated_at||v.created_at).getTime()-new Date(d.updated_at||d.created_at).getTime())[0]:null},staleTime:3e5,enabled:!!s});return{previewData:x.useMemo(()=>i?{fullName:`${i.first_name} ${i.last_name}`,idNumber:i.id_number,course:t||i.course||"COURSE",photo:we(i.id_picture),signature:we(i.signature_picture),guardian_name:i.guardian_name,guardian_contact:i.guardian_contact,address:i.address}:null,[i,t]),activeStudent:i,isLoading:c}},vs=8,ze=15,js=96,ws=3.78,D={CANVAS_EDGE:4,CANVAS_CENTER:3.5,OBJECT_EDGE:3,OBJECT_CENTER:2.5,GRID:2,SPACING:1},zs=s=>{const{snapEnabled:t,isTransforming:i,setSnapLines:c,snapMode:o,gridUnit:p}=X(),h=x.useCallback(()=>{switch(p){case"inch":return js/4;case"mm":return ws*5;default:return 10}},[p]),d=x.useCallback((b,m)=>{if(b.length<2)return[];const l=[...b].sort((n,a)=>m==="horizontal"?n.x-a.x:n.y-a.y),r=[];for(let n=1;n<l.length;n++){const a=l[n-1],u=l[n],N=m==="horizontal"?u.x-(a.x+a.width):u.y-(a.y+a.height);N>0&&r.push(m==="horizontal"?u.x+u.width+N:u.y+u.height+N)}return r},[]),v=x.useCallback(b=>{const m=b.x(),l=b.y(),r=b.width()*b.scaleX(),n=b.height()*b.scaleY(),a=b.rotation();return{vertical:[{position:m,offset:0,type:"left"},{position:m+r/2,offset:-r/2,type:"center"},{position:m+r,offset:-r,type:"right"}],horizontal:[{position:l,offset:0,type:"top"},{position:l+n/2,offset:-n/2,type:"center"},{position:l+n,offset:-n,type:"bottom"}],isRotated:Math.abs(a%360)>1}},[]),w=x.useCallback(b=>{const m=[{position:0,type:"canvas-edge",priority:D.CANVAS_EDGE,source:"canvas-left"},{position:A,type:"canvas-edge",priority:D.CANVAS_EDGE,source:"canvas-right"},{position:A/2,type:"canvas-center",priority:D.CANVAS_CENTER,source:"canvas-center-v"}],l=[{position:0,type:"canvas-edge",priority:D.CANVAS_EDGE,source:"canvas-top"},{position:P,type:"canvas-edge",priority:D.CANVAS_EDGE,source:"canvas-bottom"},{position:P/2,type:"canvas-center",priority:D.CANVAS_CENTER,source:"canvas-center-h"}];if(!s.current)return{vertical:m,horizontal:l};const r=[];return s.current.children.forEach(n=>{if(n===b||n.name()==="background"||n.getClassName()==="Transformer"||n.getClassName()==="Line"||!n.visible())return;const a={x:n.x(),y:n.y(),width:n.width()*n.scaleX(),height:n.height()*n.scaleY(),name:n.name()};r.push(a),(o==="smart"||o==="both")&&(m.push({position:a.x,type:"edge",priority:D.OBJECT_EDGE,source:`${a.name}-l`},{position:a.x+a.width/2,type:"center",priority:D.OBJECT_CENTER,source:`${a.name}-c`},{position:a.x+a.width,type:"edge",priority:D.OBJECT_EDGE,source:`${a.name}-r`}),l.push({position:a.y,type:"edge",priority:D.OBJECT_EDGE,source:`${a.name}-t`},{position:a.y+a.height/2,type:"center",priority:D.OBJECT_CENTER,source:`${a.name}-c`},{position:a.y+a.height,type:"edge",priority:D.OBJECT_EDGE,source:`${a.name}-b`}))}),(o==="smart"||o==="both")&&(d(r,"horizontal").forEach(n=>m.push({position:n,type:"spacing",priority:D.SPACING,source:"spacing"})),d(r,"vertical").forEach(n=>l.push({position:n,type:"spacing",priority:D.SPACING,source:"spacing"}))),{vertical:m,horizontal:l}},[s,o,d]),j=x.useCallback((b,m)=>{const l=[];return b.forEach(r=>{m.forEach(n=>{const a=Math.abs(n.position-r.position),u=a<ze?ze:vs;a<u&&l.push({position:n.position,diff:a,offset:r.offset,type:`${r.type}-to-${n.type}`,priority:n.priority})})}),l.length===0?null:l.sort((r,n)=>Math.abs(r.priority-n.priority)>.1?n.priority-r.priority:r.diff-n.diff)[0]},[]),y=x.useCallback(b=>{if(!t||i){c({vertical:[],horizontal:[]});return}const m=b.target,l=v(m);if(l.isRotated){c({vertical:[],horizontal:[]});return}const{vertical:r,horizontal:n}=w(m);if(o==="grid"||o==="both"){const z=h();l.vertical.forEach(T=>{const f=Math.round(T.position/z)*z;r.push({position:f,type:"grid",priority:D.GRID})}),l.horizontal.forEach(T=>{const f=Math.round(T.position/z)*z;n.push({position:f,type:"grid",priority:D.GRID})})}const a=j(l.vertical,r),u=j(l.horizontal,n),N={vertical:[],horizontal:[]};a&&(m.x(a.position+a.offset),N.vertical.push(a.position)),u&&(m.y(u.position+u.offset),N.horizontal.push(u.position)),c(N)},[t,i,v,w,j,c,o,h]),k=x.useCallback((b,m)=>{if(!t)return;const l=w(b),r=v(b);if(o==="grid"||o==="both"){const n=h();r.vertical.forEach(a=>{l.vertical.push({position:Math.round(a.position/n)*n,type:"grid",priority:D.GRID})}),r.horizontal.forEach(a=>{l.horizontal.push({position:Math.round(a.position/n)*n,type:"grid",priority:D.GRID})})}if(m==="vertical"||m==="both"){const n=j(r.vertical,l.vertical);n&&b.x(n.position+n.offset)}if(m==="horizontal"||m==="both"){const n=j(r.horizontal,l.horizontal);n&&b.y(n.position+n.offset)}},[t,w,v,j,o,h]);return{handleDragMove:y,snapToNearest:k}},Ns=(s,t)=>{const{setIsTransforming:i,setSnapLines:c}=X(),{tempLayout:o,editSide:p,updateItem:h}=q(),d=x.useCallback(()=>{i(!0)},[i]),v=x.useCallback(j=>{const y=j.target,k=y.scaleX(),b=y.scaleY(),m=Math.max(10,y.width()*k),l=Math.max(10,y.height()*b);y.setAttrs({width:m,height:l,scaleX:1,scaleY:1});const r=y.findOne("Text"),n=y.findOne("Image"),a=y.findOne(".Shape"),u=y.findOne(".Bounds");if(r&&(r.width(m),r.height(l)),n&&(n.width(m),n.height(l)),u&&(u.width(m),u.height(l)),a)if(a.getClassName()==="Circle"){const N=m/2;a.setAttrs({radius:N,x:N,y:N})}else a.setAttrs({width:m,height:l});t.current?.batchDraw()},[t]),w=x.useCallback(j=>{i(!1);const y=j.target,k=y.name();if(!k)return;const b=y.findOne("Text"),m=p.toLowerCase(),l=o[m]?.[k],r={x:Math.round(y.x()),y:Math.round(y.y()),width:Math.round(y.width()),height:Math.round(y.height()),rotation:Math.round(y.rotation())};b&&l?.fit==="stretch"&&(r.fontSize=Math.round(b.fontSize())),c({vertical:[],horizontal:[]}),h(k,r)},[i,p,o,h,c]);return x.useEffect(()=>{if(!s.current)return;const j=s.current;return j.on("transformstart",d),j.on("transform",v),j.on("transformend",w),()=>{j.off("transformstart",d),j.off("transform",v),j.off("transformend",w)}},[s,d,v,w]),null},ks=({zoom:s})=>e.jsx("div",{className:"h-6 w-full bg-zinc-900 border-b border-zinc-800 relative overflow-hidden flex text-[9px] text-zinc-500 font-mono select-none",children:Array.from({length:40}).map((t,i)=>e.jsx("div",{className:"absolute bottom-0 border-l border-zinc-700 h-2",style:{left:i*50*s},children:i>0&&e.jsx("span",{className:"absolute -top-4 -left-2",children:i*50})},i))}),Cs=({zoom:s})=>e.jsx("div",{className:"w-6 h-full bg-zinc-900 border-r border-zinc-800 relative overflow-hidden flex flex-col text-[9px] text-zinc-500 font-mono select-none",children:Array.from({length:60}).map((t,i)=>e.jsx("div",{className:"absolute right-0 border-t border-zinc-700 w-2",style:{top:i*50*s},children:i>0&&e.jsx("span",{className:"absolute -left-5 -top-2 w-4 text-right",children:i*50})},i))}),Ss=({id:s,config:t,isSelected:i,zoom:c,previewText:o,image:p,anyItemSelected:h,onDragMove:d,onDragEnd:v,onSelect:w,onUpdate:j})=>{const y=s==="photo",k=s==="signature",b=s.startsWith("img")||t.type==="image",m=s.startsWith("rect")||s.startsWith("circle")||t.type==="rect"||t.type==="circle",[l]=K(b&&!y&&!k&&t.src||"","anonymous"),r=y||k?p:l,n=()=>!t.locked,a="#6366f1",u={name:s,x:t.x,y:t.y,rotation:t.rotation||0,opacity:t.opacity??1,draggable:i&&!t.locked,listening:n(),onClick:E=>{E.cancelBubble=!0,w(s)},onTap:E=>{E.cancelBubble=!0,w(s)},onDragMove:d,onDragEnd:v};if(y||k||b||m){const E=t.width||100,$=t.height||100;return e.jsxs(be,{...u,width:E,height:$,children:[e.jsx(re,{name:"Bounds",width:E,height:$,stroke:a,strokeWidth:1.5/c,opacity:i?1:0,listening:!1}),(y||k||b)&&r&&e.jsx(Ee,{name:"Image",image:r,width:E,height:$,sceneFunc:(ie,W)=>{const O=W.width(),Q=W.height(),G=Math.min(O/r.width,Q/r.height),ae=(O-r.width*G)/2,B=(Q-r.height*G)/2;ie.drawImage(r,ae,B,r.width*G,r.height*G)}}),m&&(t.type==="circle"?e.jsx(st,{name:"Shape",x:E/2,y:$/2,radius:E/2,fill:t.fill||"#6366f1"}):e.jsx(re,{name:"Shape",width:E,height:$,fill:t.fill||"#6366f1",cornerRadius:t.radius||0}))]})}const N=o||t.text||`${s}`,{fontSize:z,wrap:T}=nt(t,N),f=t.width||200,S=t.fit==="none"?void 0:t.height||40;return e.jsxs(be,{...u,width:f,height:S,children:[e.jsx(re,{name:"Bounds",width:f,height:S||20,stroke:a,strokeWidth:1/c,dash:[4,2],opacity:i?.8:0,listening:!1}),e.jsx(it,{name:"Text",text:N,fontSize:z,width:f,height:S,fontFamily:t.fontFamily||"Arial",fontStyle:t.fontStyle||"bold",fill:t.fill||"#1e293b",align:t.align||"center",verticalAlign:"middle",wrap:T,ellipsis:t.overflow==="ellipsis"})]})},Es="/assets/NEWFRONT-DM2t3XDK.png",_s="/assets/BACK-10geZSjV.png",U=({icon:s,label:t,active:i,onClick:c,badge:o})=>e.jsxs("button",{onClick:c,title:t,className:`p-2 rounded-lg transition-all flex items-center gap-1.5 justify-center relative ${i?"bg-indigo-500/20 text-indigo-400 border border-indigo-500/50":"text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200 border border-transparent"}`,children:[e.jsx(s,{size:18,strokeWidth:2}),o&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-tighter bg-zinc-800 px-1 rounded border border-zinc-700",children:o})]}),Ms=({stageRef:s})=>{const{editSide:t,currentSideData:i,templateId:c,templateName:o,updateItem:p}=q(),{zoom:h,setZoom:d,showGrid:v,setShowGrid:w,snapEnabled:j,setSnapEnabled:y,snapMode:k,setSnapMode:b,gridUnit:m,setGridUnit:l,showSnapGuides:r,snapLines:n,setSnapLines:a}=X(),{selectedId:u,setSelectedId:N}=ne(),z=x.useRef(null),T=x.useRef(null),f=x.useRef(null),[S,E]=x.useState(!1),[$]=K(Es),[ie]=K(_s),W=t==="FRONT"?$:ie,{previewData:O}=Fe(c,o),[Q]=K(O?.photo||"","anonymous"),[G]=K(O?.signature||"","anonymous"),{handleDragMove:ae}=zs(T);Ns(z,T);const B=x.useCallback(()=>{if(!f.current)return;const g=f.current,_=g.scrollWidth,M=g.scrollHeight,I=g.clientWidth,R=g.clientHeight;g.scrollTo({left:(_-I)/2,top:(M-R)/2,behavior:"smooth"})},[]);x.useEffect(()=>{const g=setTimeout(B,100);return()=>clearTimeout(g)},[B,t]),x.useEffect(()=>{const g=M=>{if(M.ctrlKey||M.metaKey){M.preventDefault();const I=M.deltaY>0?-.1:.1;d(R=>Math.min(le,Math.max(ce,R+I)))}},_=f.current;return _&&_.addEventListener("wheel",g,{passive:!1}),()=>_?.removeEventListener("wheel",g)},[d]),x.useEffect(()=>{const g=M=>{if(!(M.target instanceof HTMLInputElement||M.target instanceof HTMLTextAreaElement)&&(M.key===" "&&(S||E(!0),M.preventDefault()),u&&i?.[u])){const I=M.shiftKey?10:1,R=i[u];["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(M.key)&&(M.preventDefault(),p(u,{x:R.x+(M.key==="ArrowLeft"?-I:M.key==="ArrowRight"?I:0),y:R.y+(M.key==="ArrowUp"?-I:M.key==="ArrowDown"?I:0)}))}},_=M=>{M.key===" "&&E(!1)};return window.addEventListener("keydown",g),window.addEventListener("keyup",_),()=>{window.removeEventListener("keydown",g),window.removeEventListener("keyup",_)}},[u,i,S,p]);const qe=g=>{if(S||g.button===1){g.preventDefault();const _=f.current;if(!_)return;const M=g.pageX+_.scrollLeft,I=g.pageY+_.scrollTop,R=me=>{_.scrollLeft=M-me.pageX,_.scrollTop=I-me.pageY},pe=()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",pe)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",pe)}};x.useEffect(()=>{if(!s.current||!z.current)return;const g=s.current.findOne("."+u);z.current.nodes(g?[g]:[])},[u,t,s]);const We=()=>{const g=["smart","grid","both"],_=g.indexOf(k);b(g[(_+1)%g.length])},Be=()=>{const g=["px","inch","mm"],_=g.indexOf(m);l(g[(_+1)%g.length])};return e.jsxs("div",{className:"flex-1 relative bg-[#09090b] flex flex-col overflow-hidden",children:[e.jsx("div",{className:"h-10 border-b border-zinc-800 bg-zinc-900 flex items-center justify-between px-4 py-1 z-10 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{icon:Me,active:j,onClick:()=>y(!j),label:"Toggle Snapping"}),e.jsx(U,{icon:Tt,active:j,onClick:We,label:`Snap Mode: ${k}`,badge:k}),e.jsx("div",{className:"w-px h-4 bg-zinc-800 mx-1"}),e.jsx(U,{icon:Lt,active:v,onClick:()=>w(!v),label:"Toggle Grid Visibility"}),e.jsx(U,{icon:ss,onClick:Be,label:`Grid Unit: ${m}`,badge:m}),e.jsx("div",{className:"w-px h-4 bg-zinc-800 mx-1"}),e.jsx(U,{icon:Te,onClick:B,label:"Recenter Canvas"}),e.jsx("div",{className:"w-px h-4 bg-zinc-800 mx-2"}),e.jsxs("span",{className:"text-[10px] text-zinc-500 uppercase font-bold tracking-tight",children:["Canvas: ",A," Ã— ",P,"px"]})]})}),e.jsxs("div",{className:"flex-1 flex relative overflow-hidden",children:[e.jsx(Cs,{zoom:h}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ks,{zoom:h}),e.jsx("div",{ref:f,onMouseDown:qe,className:`flex-1 overflow-auto bg-zinc-900 relative scrollbar-hide ${S?"cursor-grab active:cursor-grabbing":"cursor-default"}`,children:e.jsx("div",{className:"flex items-center justify-center min-w-full min-h-full",style:{padding:"1000px"},children:e.jsxs("div",{className:"shadow-[0_0_100px_rgba(0,0,0,0.1)] bg-white relative shrink-0 z-0",style:{width:A*h,height:P*h,pointerEvents:S?"none":"auto"},children:[v&&e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-[0.05] z-10",style:{backgroundImage:"radial-gradient(#000 1px, transparent 1px)",backgroundSize:`${20*h}px ${20*h}px`}}),e.jsx(at,{ref:s,width:A*h,height:P*h,scaleX:h,scaleY:h,onMouseDown:g=>{g.target===g.target.getStage()&&N(null)},children:e.jsxs(ot,{ref:T,children:[W&&e.jsx(Ee,{name:"background",image:W,width:A,height:P,listening:!1}),i&&Object.entries(i).map(([g,_])=>_.visible!==!1?e.jsx(Ss,{id:g,config:_,isSelected:u===g,zoom:h,image:g==="photo"?Q:g==="signature"?G:void 0,previewText:O?.[g]||(g==="course"?o:void 0),onSelect:N,onUpdate:p,onDragMove:ae,onDragEnd:M=>{p(g,{x:Math.round(M.target.x()),y:Math.round(M.target.y())}),a({vertical:[],horizontal:[]})},anyItemSelected:!!u},g):null),j&&r&&e.jsxs(e.Fragment,{children:[n.vertical.map((g,_)=>e.jsx(ye,{points:[g,-5e3,g,5e3],stroke:"#6366f1",strokeWidth:1/h,dash:[4,4],listening:!1},`v-${_}`)),n.horizontal.map((g,_)=>e.jsx(ye,{points:[-5e3,g,5e3,g],stroke:"#6366f1",strokeWidth:1/h,dash:[4,4],listening:!1},`h-${_}`))]}),e.jsx(rt,{ref:z,rotateEnabled:!0,enabledAnchors:ct(u?i[u]:null),anchorSize:8/h,anchorCornerRadius:2,borderStrokeWidth:1.5/h,anchorStroke:"#6366f1",anchorFill:"#fff",borderStroke:"#6366f1"})]})})]})})})]})]})]})},J=({icon:s,label:t})=>e.jsxs("div",{className:"flex items-center gap-2 mb-3 mt-2",children:[e.jsx(s,{size:12,className:"text-zinc-500"}),e.jsx("span",{className:"text-[10px] font-black text-zinc-400 uppercase tracking-[0.1em]",children:t})]}),F=({label:s,children:t,className:i=""})=>e.jsxs("div",{className:`space-y-1.5 ${i}`,children:[s&&e.jsx("label",{className:"text-[9px] font-medium text-zinc-500 ml-1",children:s}),t]}),Ts=({selectedId:s,config:t,onUpdate:i,onDelete:c,onMoveLayer:o,isTextLayer:p})=>{if(!s||!t)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-8 bg-zinc-900/50",children:[e.jsx("div",{className:"w-16 h-16 bg-zinc-800 rounded-2xl flex items-center justify-center mb-4 border border-zinc-700/50",children:e.jsx(De,{size:24,strokeWidth:1.5,className:"text-zinc-600 animate-pulse"})}),e.jsx("p",{className:"text-[11px] font-bold uppercase tracking-widest text-zinc-400",children:"Select an object"}),e.jsx("p",{className:"text-[10px] text-zinc-600 mt-2 leading-relaxed",children:"Select a layer on the canvas to inspect and edit its properties."})]});const h=p(s)||t.type==="text";return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-900 border-l border-zinc-800 overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-800 bg-zinc-950/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-500/10 border border-indigo-500/20 flex items-center justify-center text-indigo-400",children:h?e.jsx(se,{size:16}):e.jsx(te,{size:16})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-zinc-200 truncate max-w-[120px]",children:h?"Text Layer":"Shape Object"}),e.jsxs("p",{className:"text-[9px] text-zinc-500 font-mono",children:["ID: ",s.slice(0,8)]})]})]}),e.jsx("button",{onClick:()=>i(s,{locked:!t.locked}),className:`p-2 rounded-lg transition-all ${t.locked?"bg-orange-500 text-white":"bg-zinc-800 text-zinc-400 hover:text-zinc-200"}`,children:t.locked?e.jsx(Ye,{size:14}):e.jsx(Ot,{size:14})})]}),e.jsxs("div",{className:"p-4 space-y-8",children:[e.jsxs("section",{children:[e.jsx(J,{icon:Le,label:"Transform"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-4",children:[e.jsx(F,{label:"Width",children:e.jsxs("div",{className:"flex items-center bg-zinc-950 border border-zinc-800 rounded-md px-2 focus-within:border-indigo-500/50 transition-colors",children:[e.jsx("span",{className:"text-[9px] text-zinc-600 font-bold mr-2",children:"W"}),e.jsx("input",{type:"number",value:Math.round(t.width||0),onChange:d=>i(s,{width:parseInt(d.target.value)}),className:"w-full bg-transparent py-1.5 text-xs font-mono text-zinc-200 outline-none"})]})}),e.jsx(F,{label:"Height",children:e.jsxs("div",{className:"flex items-center bg-zinc-950 border border-zinc-800 rounded-md px-2 focus-within:border-indigo-500/50 transition-colors",children:[e.jsx("span",{className:"text-[9px] text-zinc-600 font-bold mr-2",children:"H"}),e.jsx("input",{type:"number",value:Math.round(t.height||0),onChange:d=>i(s,{height:parseInt(d.target.value)}),className:"w-full bg-transparent py-1.5 text-xs font-mono text-zinc-200 outline-none"})]})}),e.jsx(F,{label:"Rotation",children:e.jsxs("div",{className:"flex items-center bg-zinc-950 border border-zinc-800 rounded-md px-2 focus-within:border-indigo-500/50 transition-colors",children:[e.jsx(es,{size:10,className:"text-zinc-600 mr-2"}),e.jsx("input",{type:"number",value:t.rotation||0,onChange:d=>i(s,{rotation:parseInt(d.target.value)}),className:"w-full bg-transparent py-1.5 text-xs font-mono text-zinc-200 outline-none"}),e.jsx("span",{className:"text-[9px] text-zinc-600",children:"Â°"})]})}),e.jsx(F,{label:"Opacity",children:e.jsxs("div",{className:"flex items-center bg-zinc-950 border border-zinc-800 rounded-md px-2 focus-within:border-indigo-500/50 transition-colors",children:[e.jsx(It,{size:10,className:"text-zinc-600 mr-2"}),e.jsx("input",{type:"number",min:"0",max:"100",value:Math.round((t.opacity??1)*100),onChange:d=>i(s,{opacity:parseFloat(d.target.value)/100}),className:"w-full bg-transparent py-1.5 text-xs font-mono text-zinc-200 outline-none"}),e.jsx("span",{className:"text-[9px] text-zinc-600",children:"%"})]})})]})]}),e.jsxs("section",{children:[e.jsx(J,{icon:Kt,label:"Appearance"}),e.jsxs("div",{className:"bg-zinc-950 border border-zinc-800 rounded-xl p-3 flex items-center justify-between group hover:border-zinc-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative w-6 h-6 rounded-md border border-zinc-700 overflow-hidden shadow-inner",children:e.jsx("input",{type:"color",value:t.fill||"#000000",onChange:d=>i(s,{fill:d.target.value}),className:"absolute inset-0 w-[200%] h-[200%] -translate-x-1/4 -translate-y-1/4 cursor-pointer"})}),e.jsx("span",{className:"text-[11px] font-mono uppercase text-zinc-400 group-hover:text-zinc-200 transition-colors",children:t.fill||"#000000"})]}),e.jsx("span",{className:"text-[9px] text-zinc-600 font-bold",children:"100%"})]})]}),h&&e.jsxs("section",{className:"space-y-6",children:[e.jsx(J,{icon:se,label:"Typography"}),e.jsx(F,{label:"Content",children:e.jsx("textarea",{value:t.text||"",onChange:d=>i(s,{text:d.target.value}),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg p-3 text-xs text-zinc-200 outline-none focus:border-indigo-500/50 h-24 resize-none leading-relaxed transition-all",placeholder:"Enter text..."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("span",{className:"text-[9px] font-bold text-zinc-500 uppercase tracking-wider",children:"Font Size"}),e.jsxs("span",{className:"text-[10px] font-mono text-indigo-400",children:[t.fontSize||18,"px"]})]}),e.jsx("input",{type:"range",min:"8",max:"100",value:t.fontSize||18,onChange:d=>i(s,{fontSize:parseInt(d.target.value)}),className:"w-full h-1.5 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),e.jsx(F,{label:"Fit Mode",children:e.jsx("div",{className:"grid grid-cols-4 gap-1 bg-zinc-950 p-1 rounded-lg border border-zinc-800",children:["none","wrap","shrink","stretch"].map(d=>e.jsx("button",{onClick:()=>i(s,{fit:d}),className:`py-1.5 text-[8px] uppercase font-black rounded-md transition-all ${t.fit===d?"bg-zinc-800 text-indigo-400 shadow-sm":"text-zinc-600 hover:text-zinc-400"}`,children:d},d))})})]}),e.jsxs("section",{children:[e.jsx(J,{icon:Ze,label:"Arrangement"}),e.jsxs("div",{className:"flex gap-1 bg-zinc-950 p-1 rounded-xl border border-zinc-800",children:[e.jsx(ee,{onClick:()=>o("top"),icon:e.jsx(jt,{size:14}),title:"Bring to Front"}),e.jsx(ee,{onClick:()=>o("up"),icon:e.jsx(xt,{size:14}),title:"Bring Forward"}),e.jsx(ee,{onClick:()=>o("down"),icon:e.jsx(yt,{size:14}),title:"Send Backward"}),e.jsx(ee,{onClick:()=>o("bottom"),icon:e.jsx(gt,{size:14}),title:"Send to Back"})]})]}),e.jsx("div",{className:"pt-6",children:e.jsxs("button",{onClick:c,className:"w-full py-3 text-[11px] font-bold text-zinc-500 hover:text-red-400 hover:bg-red-500/5 rounded-xl border border-zinc-800 hover:border-red-500/20 flex items-center justify-center gap-2 transition-all group",children:[e.jsx(ue,{size:14,className:"group-hover:scale-110 transition-transform"}),"Delete Layer"]})})]})]})},ee=({onClick:s,icon:t,title:i})=>e.jsx("button",{onClick:s,title:i,className:"flex-1 flex items-center justify-center p-2.5 hover:bg-zinc-800 text-zinc-500 hover:text-zinc-200 rounded-lg transition-all active:scale-90",children:t}),Ds=()=>{const{currentSideData:s,updateItem:t}=q(),{selectedId:i,handleDelete:c,moveLayer:o}=ne(),p=h=>!["photo","signature"].includes(h)&&!h.startsWith("rect")&&!h.startsWith("circle")&&!h.startsWith("img");return e.jsxs("div",{className:"w-72 border-l border-zinc-800 bg-zinc-900 p-6 flex flex-col gap-6 overflow-y-auto shrink-0",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-zinc-500 tracking-widest",children:"Properties"}),e.jsx(Ts,{selectedId:i,config:i?s[i]:null,onUpdate:t,onDelete:c,onMoveLayer:o,isTextLayer:p})]})},Ls=({templateId:s,templateName:t})=>{const i=x.useRef(null),{previewData:c}=Fe(s,t);return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-950 text-zinc-200 overflow-hidden font-sans border border-zinc-800 shadow-2xl select-none",children:[e.jsx(fs,{stageRef:i,previewData:c}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(gs,{}),e.jsx(ys,{}),e.jsx(Ms,{stageRef:i}),e.jsx(Ds,{})]})]})},$s=({templateId:s,templateName:t,onSave:i,currentLayout:c})=>e.jsx(us,{templateId:s,templateName:t,currentLayout:c,onSave:i,children:e.jsx(ps,{children:e.jsx(ms,{children:e.jsx(Ls,{templateId:s,templateName:t})})})}),Is=({selectedTemplate:s,setSelectedTemplate:t,saveCount:i,setSaveCount:c})=>{const[o,p]=x.useState(!1);return e.jsxs("div",{className:"flex h-full bg-zinc-950 border border-zinc-800 shadow-xl overflow-hidden relative",children:[e.jsxs("div",{className:`transition-all duration-300 ease-in-out border-r border-zinc-800 shrink-0 relative ${o?"w-16":"w-64"}`,children:[e.jsx(xs,{activeId:s?.id,onSelect:h=>t(h),refreshTrigger:i,isCollapsed:o}),e.jsx("button",{onClick:()=>p(!o),className:"absolute -right-3 top-1/2 -translate-y-1/2 z-50 bg-zinc-800 border border-zinc-700 text-zinc-400 hover:text-white p-1 rounded-full shadow-md transition-colors","aria-label":o?"Expand sidebar":"Collapse sidebar",children:o?e.jsx(Ce,{size:14}):e.jsx(pt,{size:14})})]}),e.jsx("div",{className:"flex-1 relative min-w-0 bg-zinc-950",children:s?e.jsx($s,{templateId:s.id,templateName:s.name,currentLayout:{front:{...s.front_config},back:{...s.back_config}},onSave:h=>{t(d=>({...d,front_config:h.front,back_config:h.back})),c(d=>d+1)}}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-zinc-900/30",children:[e.jsx("div",{className:"p-8 rounded-full bg-zinc-900/50 mb-4 text-zinc-700 border border-zinc-800",children:e.jsx($e,{size:48,strokeWidth:1})}),e.jsx("p",{className:"text-zinc-600 font-black uppercase tracking-[0.2em] text-[10px]",children:"Select a template to begin designing"})]})})]})},Vs=()=>{const[s,t]=x.useState(null),[i,c]=x.useState(0);return e.jsx("div",{className:"h-full",children:e.jsx(Is,{selectedTemplate:s,setSelectedTemplate:t,saveCount:i,setSaveCount:c})})};export{Vs as default};
