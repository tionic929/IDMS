import{c as p,Q as H,r as l,j as e,T as R,A as K,U as Q,L as S,V as W,d as Y,W as Z}from"./index-B2x0YJuC.js";import{v as J}from"./reports-ex1dxaou.js";import{A as X}from"./arrow-left-BOh_Vy0S.js";import{S as ee}from"./shield-check-CnvOBseR.js";import{C as F}from"./circle-check-emOfRh_b.js";import{C as U}from"./circle-alert-RxOKjV3t.js";const se=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],ae=p("book-open",se);const te=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ie=p("camera",te);const re=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],le=p("cloud-upload",re);const ne=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],L=p("file-check",ne);const ce=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],oe=p("refresh-ccw",ce);const de=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],me=p("zap",de),ue="https://glacial-samiyah-presutural.ngrok-free.dev",je=()=>{const m=H(),[s,r]=l.useState({idNumber:"",firstName:"",middleInitial:"",lastName:"",course:"",address:"",guardianName:"",guardianContact:"",id_picture:null,signature_picture:null}),[x,d]=l.useState(!1),[c,u]=l.useState("idle"),[$,D]=l.useState(""),[j,_]=l.useState(!1),[pe,E]=l.useState("idle"),[T,v]=l.useState({id:0,sig:0}),[y,I]=l.useState(!1),[w,z]=l.useState(!1),[N,A]=l.useState(""),k=!s.idNumber||!s.firstName||!s.lastName||!s.id_picture||!s.signature_picture,O=a=>{v(i=>({...i,[a]:0}));const t=setInterval(()=>{v(i=>{const n=i[a];return n>=95?(clearInterval(t),i):{...i,[a]:n+(n<70?15:2)}})},200);return t},P=async(a,t)=>{const i=a.target.files?.[0];if(!i)return;const n=t==="id_picture"?"id":"sig";r(b=>({...b,[t]:i})),t==="id_picture"?I(!0):z(!0);const q=O(n);try{const b=await new Promise(f=>{const C=new FileReader;C.onload=()=>f(C.result),C.readAsDataURL(i)}),B=await Z.post(`${ue}/process_and_return`,{photo:b,type:t},{responseType:"blob",timeout:6e4}),G=new File([B.data],`ai_${n}.webp`,{type:"image/webp"});r(f=>({...f,[t]:G})),v(f=>({...f,[n]:100}))}catch(b){console.warn("AI Enhancement skipped/failed, using raw file:",b)}finally{clearInterval(q),setTimeout(()=>{I(!1),z(!1)},500)}},h=l.useMemo(()=>s.id_picture?URL.createObjectURL(s.id_picture):"",[s.id_picture]),g=l.useMemo(()=>s.signature_picture?URL.createObjectURL(s.signature_picture):"",[s.signature_picture]);l.useEffect(()=>()=>{h&&URL.revokeObjectURL(h),g&&URL.revokeObjectURL(g)},[h,g]);const V=async a=>{if(a.preventDefault(),!k){_(!0);try{await W();const t=new FormData;t.append("idNumber",s.idNumber),t.append("firstName",s.firstName),t.append("middleInitial",s.middleInitial),t.append("lastName",s.lastName),t.append("course",s.course),t.append("address",s.address),t.append("guardianName",s.guardianName),t.append("guardianContact",s.guardianContact),s.id_picture&&t.append("id_picture",s.id_picture),s.signature_picture&&t.append("signature_picture",s.signature_picture);const i=await Y.post("/students",t,{headers:{"Content-Type":"multipart/form-data"}});console.log("✅ Server Response:",i.data),A("success"),window.scrollTo({top:0,behavior:"smooth"})}catch(t){console.error("❌ Critical Submission Failure:",t),A("error")}finally{_(!1),E("idle")}}};return l.useEffect(()=>{if(s.idNumber.length>=8){const a=setTimeout(async()=>{d(!0);try{const t=await J(s.idNumber);if(t.valid){u("valid");const i=t.data;r(n=>({...n,firstName:i.firstName||"",middleInitial:i.middleName?i.middleName.charAt(0).toUpperCase():"",lastName:i.lastName||"",course:i.course||n.course}))}}catch{u("invalid"),D("ID Not Found")}finally{d(!1)}},800);return()=>clearTimeout(a)}},[s.idNumber]),e.jsxs("div",{className:"min-h-screen bg-[#f1f5f9] font-sans pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-2xl border-b border-slate-200 px-4 md:px-10 py-4",children:e.jsxs("div",{className:"max-w-[1440px] mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>m("/"),className:"flex items-center gap-3 text-slate-600 font-bold group",children:[e.jsx("div",{className:"p-2.5 bg-slate-100 group-hover:bg-teal-50 rounded-2xl transition-colors",children:e.jsx(X,{size:22})}),e.jsx("span",{className:"hidden md:inline-block text-sm",children:"Cancel"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-[10px] font-black tracking-[0.3em] text-teal-600 uppercase",children:"NCnian Digital ID"}),e.jsx("p",{className:"text-sm lg:text-xl font-black text-slate-900 uppercase",children:"Student Registration"})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-slate-400 bg-slate-50 px-4 py-2 rounded-2xl border border-slate-100",children:[e.jsx(ee,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter",children:"Verified"})]})]})}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-7xl mx-auto mt-8 px-4",children:[e.jsx(K,{children:(N==="success"||c==="invalid")&&e.jsxs(R.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:`mb-6 p-6 rounded-[2rem] border shadow-sm flex items-center justify-between ${N==="success"?"bg-emerald-50 border-emerald-200 text-emerald-700":"bg-rose-50 border-rose-200 text-rose-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N==="success"?e.jsx(F,{size:20}):e.jsx(U,{size:20}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:N==="success"?"Application Submitted!":$})]}),e.jsx("button",{onClick:()=>m("/"),className:"bg-white text-emerald-700 px-8 py-3 rounded-2xl text-xs font-black hover:bg-emerald-50 transition-colors",children:"RETURN"})]})}),e.jsxs("form",{onSubmit:V,className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs(M,{icon:e.jsx(ae,{}),title:"School Credentials",subtitle:"Academic Verification",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(o,{label:"Student ID Number",value:s.idNumber,onChange:a=>r({...s,idNumber:a}),status:c,isLoading:x}),e.jsx(o,{label:"Course/Year",value:s.course,onChange:a=>r({...s,course:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mt-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(o,{label:"First Name",value:s.firstName,onChange:a=>r({...s,firstName:a})})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(o,{label:"M.I.",value:s.middleInitial,onChange:a=>r({...s,middleInitial:a})})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(o,{label:"Last Name",value:s.lastName,onChange:a=>r({...s,lastName:a})})})]})]}),e.jsxs(M,{icon:e.jsx(Q,{}),title:"Emergency Contact",subtitle:"Contact Information",children:[e.jsx(o,{label:"Home Address",value:s.address,onChange:a=>r({...s,address:a}),isTextArea:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsx(o,{label:"Guardian Name",value:s.guardianName,onChange:a=>r({...s,guardianName:a})}),e.jsx(o,{label:"Guardian Phone",value:s.guardianContact,onChange:a=>r({...s,guardianContact:a})})]})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-xl border border-slate-100 space-y-10 sticky top-28",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest text-center",children:"Capture Photo"}),e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-40 h-40",children:[e.jsx("div",{className:`w-full h-full rounded-[2.5rem] bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center overflow-hidden transition-all duration-300 ${y?"border-teal-500 bg-teal-50 shadow-inner":"border-slate-200"}`,children:h?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:h,className:`w-full h-full object-cover transition-opacity duration-500 ${y?"opacity-40":"opacity-100"}`}),y&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(oe,{className:"animate-spin text-teal-600",size:30}),e.jsxs("span",{className:"text-[9px] font-black text-teal-700 uppercase mt-2",children:[T.id,"% Optimizing..."]})]})]}):e.jsx(le,{size:44,className:"text-slate-300"})}),e.jsx("input",{type:"file",id:"id-p",hidden:!0,onChange:a=>P(a,"id_picture"),accept:"image/*"}),e.jsx("label",{htmlFor:"id-p",className:"absolute -bottom-2 -right-2 bg-teal-600 text-white p-3 rounded-2xl cursor-pointer shadow-lg hover:scale-110 active:scale-95 transition-transform",children:e.jsx(ie,{size:20})})]}),e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]",children:"Student Photo (2x2)"})]}),e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-full h-24",children:[e.jsx("div",{className:`w-full h-full rounded-3xl bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center overflow-hidden transition-all ${w?"border-teal-500 bg-teal-50":"border-slate-200"}`,children:g?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx("img",{src:g,className:`w-full h-full object-contain p-2 transition-opacity ${w?"opacity-30":"opacity-100"}`}),w&&e.jsx(S,{className:"absolute animate-spin text-teal-600"})]}):e.jsx(L,{size:32,className:"text-slate-300"})}),e.jsx("input",{type:"file",id:"sig-p",hidden:!0,onChange:a=>P(a,"signature_picture"),accept:"image/*"}),e.jsx("label",{htmlFor:"sig-p",className:"absolute -bottom-2 -right-2 bg-slate-800 text-white p-3 rounded-2xl cursor-pointer shadow-lg hover:scale-110 active:scale-95 transition-transform",children:e.jsx(L,{size:20})})]}),e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]",children:"E-Signature"})]}),e.jsxs("button",{type:"submit",disabled:j||c!=="valid"||k,className:`w-full py-6 rounded-[2rem] font-black text-sm tracking-[0.2em] shadow-xl transition-all flex items-center justify-center gap-2 ${c==="valid"&&!k?"bg-[#00928a] text-white hover:bg-[#007a73] active:scale-[0.98]":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:[j?e.jsx(S,{className:"animate-spin"}):e.jsx(me,{size:18}),j?"PROCESSING...":"SUBMIT APPLICATION"]})]})})]})]})]})},M=({icon:m,title:s,subtitle:r,children:x})=>e.jsxs("div",{className:"bg-white p-10 rounded-[3.5rem] shadow-sm border border-slate-200 overflow-hidden relative",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8 relative z-10",children:[e.jsx("div",{className:"w-14 h-14 bg-teal-50 rounded-[1.25rem] flex items-center justify-center text-teal-600 shadow-sm",children:m}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-slate-900 tracking-tight",children:s}),e.jsx("p",{className:"text-[10px] text-teal-600/60 font-black uppercase tracking-widest",children:r})]})]}),e.jsx("div",{className:"relative z-10",children:x})]}),o=({label:m,value:s,onChange:r,isTextArea:x=!1,status:d="idle",isLoading:c=!1})=>e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2 ml-4 tracking-[0.15em]",children:m}),e.jsx("div",{className:"relative",children:x?e.jsx("textarea",{value:s,onChange:u=>r(u.target.value),rows:3,className:"w-full bg-slate-50 border border-slate-200 rounded-[2rem] p-6 outline-none focus:bg-white focus:border-teal-500 transition-all text-sm font-bold"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:s,onChange:u=>r(u.target.value),className:`w-full bg-slate-50 border rounded-3xl p-5 outline-none transition-all ${d==="valid"?"border-emerald-500 bg-emerald-50/30":d==="invalid"?"border-rose-500 bg-rose-50/30":"border-slate-200 focus:border-teal-500 focus:bg-white"}`}),e.jsxs("div",{className:"absolute right-5 top-1/2 -translate-y-1/2",children:[c&&e.jsx(S,{className:"animate-spin text-teal-500",size:18}),d==="valid"&&!c&&e.jsx(F,{className:"text-emerald-500",size:18}),d==="invalid"&&!c&&e.jsx(U,{className:"text-rose-500",size:18})]})]})})]});export{je as default};
