import{c as h,a8 as q,r as c,j as e,a9 as L,H,U as W,L as F,aa as J,a as Y,ab as K}from"./index-DFGc9Vui.js";import{v as Q}from"./reports-D6Cf7rdN.js";import{A as X}from"./arrow-left-DWBUl1g8.js";import{S as Z}from"./shield-check-B2fNWk4-.js";import{C as D}from"./circle-check-DO7MfmYZ.js";import{C as E}from"./circle-alert-CK8uG-LL.js";const ee=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],se=h("book-open",ee);const ae=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],te=h("camera",ae);const re=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],ie=h("cloud-upload",re);const le=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],z=h("file-check",le);const ce=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],ne=h("refresh-ccw",ce),oe="https://glacial-samiyah-presutural.ngrok-free.dev",de=["image/jpeg","image/png","image/jpg"],fe=()=>{const m=q(),[s,t]=c.useState({idNumber:"",firstName:"",middleInitial:"",lastName:"",course:"",address:"",guardianName:"",guardianContact:"",id_picture:null,signature_picture:null}),[x,d]=c.useState(!1),[n,u]=c.useState("idle"),[U,R]=c.useState(""),[v,w]=c.useState(!1),[b,y]=c.useState(!1),[f,k]=c.useState(!1),[p,C]=c.useState(""),[me,S]=c.useState({}),j=!s.idNumber||!s.firstName||!s.lastName||!s.id_picture||!s.signature_picture,$=async(a,r)=>{const i=r==="id_picture"?"id":"sig";r==="id_picture"?y(!0):k(!0);try{const l=new FileReader,O=await new Promise(P=>{l.onload=()=>P(l.result),l.readAsDataURL(a)}),N=await K.post(`${oe}/process_and_return`,{photo:O,type:r},{timeout:12e4});if(N.data.status==="success"){const T=await(await fetch(N.data.processed_image)).blob(),G=new File([T],`processed_${i}.png`,{type:"image/png"});t(V=>({...V,[r]:G}))}else throw new Error(N.data.message)}catch(l){console.error("Bridge Error:",l),S(g=>({...g,[i]:"Bridge Timeout/Error. Original kept."})),t(g=>({...g,[r]:a}))}finally{y(!1),k(!1)}},_=async(a,r)=>{const i=a.target.files?.[0];if(i){if(!de.includes(i.type)){S(l=>({...l,[r==="id_picture"?"id":"sig"]:"Use JPG or PNG"}));return}await $(i,r)}},I=c.useMemo(()=>s.id_picture?URL.createObjectURL(s.id_picture):"",[s.id_picture]),A=c.useMemo(()=>s.signature_picture?URL.createObjectURL(s.signature_picture):"",[s.signature_picture]),B=async a=>{if(a.preventDefault(),!j){w(!0);try{await J();const r=new FormData;Object.entries(s).forEach(([i,l])=>{l!==null&&r.append(i,l)}),await Y.post("/students",r,{headers:{"Content-Type":"multipart/form-data"}}),C("success"),window.scrollTo({top:0,behavior:"smooth"})}catch{C("error")}finally{w(!1)}}};return c.useEffect(()=>{if(s.idNumber.length>=8){const a=setTimeout(async()=>{d(!0);try{const r=await Q(s.idNumber);if(r.valid){u("valid");const i=r.data;t(l=>({...l,firstName:i.firstName||"",middleInitial:i.middleName?i.middleName.charAt(0).toUpperCase():"",lastName:i.lastName||"",course:i.course||l.course}))}}catch{u("invalid"),R("ID Not Found")}finally{d(!1)}},800);return()=>clearTimeout(a)}},[s.idNumber]),e.jsxs("div",{className:"min-h-screen bg-[#f1f5f9] font-sans pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-2xl border-b border-slate-200 px-4 md:px-10 py-4",children:e.jsxs("div",{className:"max-w-[1440px] mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>m("/"),className:"flex items-center gap-3 text-slate-600 font-bold group",children:[e.jsx("div",{className:"p-2.5 bg-slate-100 group-hover:bg-teal-50 rounded-2xl transition-colors",children:e.jsx(X,{size:22})}),e.jsx("span",{className:"hidden md:inline-block",children:"Exit"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-[10px] font-black tracking-[0.3em] text-teal-600 uppercase",children:"NCnian School ID"}),e.jsx("p",{className:"text-sm lg:text-xl font-black text-slate-900 uppercase",children:"Application Form"})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-2 text-slate-400 bg-slate-50 px-4 py-2 rounded-2xl border border-slate-100",children:[e.jsx(Z,{size:16}),e.jsx("span",{className:"text-[10px] font-black uppercase",children:"Secure Session"})]})]})}),e.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-7xl mx-auto mt-8 px-4",children:[e.jsx(H,{children:(p==="success"||n==="invalid")&&e.jsxs(L.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`mb-6 p-6 rounded-[2rem] border shadow-sm flex items-center justify-between ${p==="success"?"bg-emerald-50 border-emerald-200 text-emerald-700":"bg-rose-50 border-rose-200 text-rose-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p==="success"?e.jsx(D,{size:20}):e.jsx(E,{size:20}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest",children:p==="success"?"Application Submitted!":U})]}),p==="success"&&e.jsx("button",{onClick:()=>m("/"),className:"bg-emerald-600 text-white px-6 py-2 rounded-xl text-xs font-bold",children:"Done"})]})}),e.jsxs("form",{onSubmit:B,className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs(M,{icon:e.jsx(se,{}),title:"Academic Standing",subtitle:"Primary Data",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(o,{label:"ID Number",value:s.idNumber,onChange:a=>t({...s,idNumber:a}),status:n,isLoading:x}),e.jsx(o,{label:"Course",value:s.course,onChange:a=>t({...s,course:a})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mt-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(o,{label:"Given Name",value:s.firstName,onChange:a=>t({...s,firstName:a})})}),e.jsx("div",{className:"md:col-span-1",children:e.jsx(o,{label:"M.I.",value:s.middleInitial,onChange:a=>t({...s,middleInitial:a})})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(o,{label:"Surname",value:s.lastName,onChange:a=>t({...s,lastName:a})})})]})]}),e.jsxs(M,{icon:e.jsx(W,{}),title:"Personal Data",subtitle:"Guardian & Address",children:[e.jsx(o,{label:"Address",value:s.address,onChange:a=>t({...s,address:a}),isTextArea:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsx(o,{label:"Guardian Name",value:s.guardianName,onChange:a=>t({...s,guardianName:a})}),e.jsx(o,{label:"Guardian Contact",value:s.guardianContact,onChange:a=>t({...s,guardianContact:a})})]})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-[3rem] shadow-xl border border-slate-100 space-y-10",children:[e.jsx("h3",{className:"text-xs font-black text-slate-400 uppercase tracking-widest text-center",children:"Biometric Previews"}),e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-40 h-40",children:[e.jsx("div",{className:`w-full h-full rounded-[2.5rem] bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center overflow-hidden ${b?"border-teal-500 bg-teal-50":"border-slate-200"}`,children:b?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ne,{className:"animate-spin text-teal-600",size:32}),e.jsx("span",{className:"text-[9px] font-black text-teal-700 uppercase",children:"Waiting for Bridge..."})]}):I?e.jsx("img",{src:I,className:"w-full h-full object-cover"}):e.jsx(ie,{size:40,className:"text-slate-300"})}),e.jsx("input",{type:"file",id:"id-p",hidden:!0,onChange:a=>_(a,"id_picture")}),e.jsx("label",{htmlFor:"id-p",className:"absolute -bottom-2 -right-2 bg-teal-600 text-white p-3 rounded-2xl cursor-pointer shadow-lg hover:scale-110 transition-transform",children:e.jsx(te,{size:20})})]}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Student Photo (2x2)"})]}),e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-full h-24",children:[e.jsx("div",{className:`w-full h-full rounded-3xl bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center overflow-hidden ${f?"border-teal-500 bg-teal-50":"border-slate-200"}`,children:f?e.jsx(F,{className:"animate-spin text-teal-600"}):A?e.jsx("img",{src:A,className:"w-full h-full object-contain p-2"}):e.jsx(z,{size:32,className:"text-slate-300"})}),e.jsx("input",{type:"file",id:"sig-p",hidden:!0,onChange:a=>_(a,"signature_picture")}),e.jsx("label",{htmlFor:"sig-p",className:"absolute -bottom-2 -right-2 bg-slate-800 text-white p-3 rounded-2xl cursor-pointer shadow-lg hover:scale-110 transition-transform",children:e.jsx(z,{size:20})})]}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Digital Signature"})]}),e.jsx("button",{type:"submit",disabled:v||b||f||n!=="valid"||j,className:`w-full py-6 rounded-[2rem] font-black text-sm tracking-[0.2em] shadow-xl transition-all ${n==="valid"&&!j?"bg-[#00928a] text-white hover:bg-[#007a73]":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:v?"PROCESSING...":"SUBMIT APPLICATION"})]})})]})]})]})},M=({icon:m,title:s,subtitle:t,children:x})=>e.jsxs("div",{className:"bg-white p-10 rounded-[3.5rem] shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"w-12 h-12 bg-teal-50 rounded-2xl flex items-center justify-center text-teal-600",children:m}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-slate-900 tracking-tight",children:s}),e.jsx("p",{className:"text-[10px] text-slate-400 font-black uppercase tracking-widest",children:t})]})]}),x]}),o=({label:m,value:s,onChange:t,isTextArea:x=!1,status:d="idle",isLoading:n=!1})=>e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 tracking-widest",children:m}),e.jsx("div",{className:"relative",children:x?e.jsx("textarea",{value:s,onChange:u=>t(u.target.value),rows:3,className:"w-full bg-slate-50 border border-slate-200 rounded-3xl p-5 outline-none focus:bg-white focus:border-teal-500 transition-all"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:s,onChange:u=>t(u.target.value),className:`w-full bg-slate-50 border rounded-3xl p-5 outline-none transition-all ${d==="valid"?"border-emerald-500":d==="invalid"?"border-rose-500":"border-slate-200 focus:border-teal-500"}`}),e.jsxs("div",{className:"absolute right-5 top-1/2 -translate-y-1/2",children:[n&&e.jsx(F,{className:"animate-spin text-teal-500",size:18}),d==="valid"&&!n&&e.jsx(D,{className:"text-emerald-500",size:18}),d==="invalid"&&!n&&e.jsx(E,{className:"text-rose-500",size:18})]})]})})]});export{fe as default};
