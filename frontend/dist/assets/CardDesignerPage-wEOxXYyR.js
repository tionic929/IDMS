import{c as y,a as se,r as u,j as e,L as ve,y as M,U as We,b as Pe,u as X,G as me,R as re,I as ze,C as Fe,T as Ge,D as Be,d as Ue,M as qe,e as He,f as D,g as O,S as Ve,h as Xe,i as fe,k as Ze,E as ge}from"./index-BnA1KfJH.js";import{C as Ke}from"./circle-check-Dp1QU0a9.js";import{S as oe,T as Ye,r as Je,g as Qe,a as et}from"./designerUtils-BxU7XFaA.js";import{A as tt}from"./arrow-up-DUP5_luv.js";import{R as st}from"./refresh-cw-DI7ab3p_.js";import{D as nt}from"./download-DBHgSdM0.js";import{g as at}from"./students-D8jXiAzs.js";const rt=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],ot=y("arrow-down-to-line",rt);const it=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ct=y("arrow-down",it);const lt=[["path",{d:"M5 3h14",key:"7usisc"}],["path",{d:"m18 13-6-6-6 6",key:"1kf1n9"}],["path",{d:"M12 7v14",key:"1akyts"}]],dt=y("arrow-up-to-line",lt);const ht=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],xt=y("box",ht);const ut=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ie=y("circle",ut);const pt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],mt=y("grid-3x3",pt);const ft=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ce=y("image",ft);const gt=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],le=y("layers",gt);const bt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],jt=y("lock-open",bt);const yt=[["path",{d:"m12 15 4 4",key:"lnac28"}],["path",{d:"M2.352 10.648a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.029-6.029a1 1 0 1 1 3 3l-6.029 6.029a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.365-6.367A1 1 0 0 0 8.716 4.282z",key:"nlhkjb"}],["path",{d:"m5 8 4 4",key:"j6kj7e"}]],vt=y("magnet",yt);const zt=[["path",{d:"M5 12h14",key:"1ays0h"}]],wt=y("minus",zt);const Nt=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],we=y("mouse-pointer-2",Nt);const kt=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],St=y("move",kt);const Ct=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],Ne=y("panels-top-left",Ct);const _t=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Mt=y("pen-tool",_t);const Lt=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ke=y("plus",Lt);const Tt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],$t=y("save",Tt);const Dt=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],be=y("type",Dt),Et=async()=>(await se.get("/card-layouts")).data,Rt=async a=>(await se.post("/card-layouts",{name:a,front_config:{photo:{x:60,y:80,width:200,height:180},fullName:{x:20,y:300,fontSize:22,fill:"#fffff",fontStyle:"bold"},course:{x:20,y:180,fontSize:14,text:a.toUpperCase(),fontStyle:"bold",fill:"#fffff"},idNumber:{x:20,y:330,fontSize:16,fill:"#fffff"}},back_config:{signature:{x:60,y:50,width:200,height:100},address:{x:20,y:210,fontSize:12},guardian_name:{x:20,y:240,fontSize:12},guardian_contact:{x:20,y:260,fontSize:12}}})).data,At=async a=>(await se.patch(`/api/card-layouts/${a}/activate`)).data,It=async(a,s,o,p=[])=>(await se.put(`/card-layouts/${a}`,{name:s,front_config:o.front,back_config:o.back,preview_images:p})).data,Ot=({onSelect:a,activeId:s,refreshTrigger:o})=>{const[p,f]=u.useState([]),[d,v]=u.useState(!0),r=async()=>{p.length===0&&v(!0);try{const i=await Et();f(i)}catch{M.error("Failed to load templates")}finally{v(!1)}};u.useEffect(()=>{r()},[o]);const j=async()=>{const i=window.prompt("Enter template name:");if(i)try{const m=await Rt(i);f([...p,m]),M.success("Template created!")}catch{M.error("Error creating template")}},h=async i=>{try{await At(i),r(),M.success("Template set as active")}catch{M.error("Error updating status")}};return e.jsxs("div",{className:"w-46 flex flex-col h-full bg-zinc-900 border-r border-zinc-800",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-800 flex items-center justify-between bg-zinc-900/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-[11px] font-black uppercase text-zinc-100 tracking-wider",children:"Library"}),e.jsx("p",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tight",children:"Templates"})]}),e.jsx("button",{onClick:j,className:"p-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-md transition-all shadow-lg shadow-indigo-500/20",title:"New Template",children:e.jsx(ke,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:[d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 opacity-20",children:[e.jsx(ve,{size:24,className:"animate-spin mb-2 text-zinc-400"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:"Loading..."})]}):p.map(i=>e.jsx("div",{onClick:()=>a(i),className:`group relative p-3 rounded-lg border transition-all cursor-pointer ${s===i.id?"bg-indigo-500/10 border-indigo-500/50":"bg-transparent border-transparent hover:bg-zinc-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:`p-2 rounded-md ${s===i.id?"bg-indigo-500 text-white":"bg-zinc-950 text-zinc-600 group-hover:text-zinc-400"}`,children:e.jsx(le,{size:14})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h4",{className:`text-[11px] font-bold truncate ${s===i.id?"text-indigo-400":"text-zinc-300"}`,children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[8px] font-mono text-zinc-600 uppercase",children:["ID: ",i.id]}),i.is_active&&e.jsx("span",{className:"text-[7px] bg-emerald-500/10 text-emerald-500 px-1 rounded font-black uppercase",children:"Active"})]})]})]}),e.jsx("button",{onClick:m=>{m.stopPropagation(),h(i.id)},className:`p-1.5 rounded-md transition-all ${i.is_active?"bg-emerald-500/20 text-emerald-400":"text-zinc-700 hover:text-emerald-500 hover:bg-emerald-500/5"}`,title:i.is_active?"Active Template":"Set as Active",children:e.jsx(Ke,{size:14})})]})},i.id)),!d&&p.length===0&&e.jsxs("div",{className:"py-20 text-center opacity-20",children:[e.jsx(Ne,{size:32,className:"mx-auto mb-4"}),e.jsx("p",{className:"text-[10px] font-bold uppercase",children:"No templates found"})]})]})]})},Wt="/assets/NEWFRONT-DM2t3XDK.png",Pt="/assets/BACK-10geZSjV.png",Ft=({layers:a,selectedId:s,onSelect:o,onAddShape:p,onAddText:f,onUploadImage:d})=>{const v=(r,j)=>r==="photo"?e.jsx(We,{size:12,className:"text-emerald-400"}):r==="signature"?e.jsx(Mt,{size:12,className:"text-amber-400"}):r.startsWith("img")||j==="image"?e.jsx(ce,{size:12,className:"text-indigo-400"}):r.startsWith("rect")?e.jsx(oe,{size:12,className:"text-zinc-400"}):r.startsWith("circle")?e.jsx(ie,{size:12,className:"text-zinc-400"}):e.jsx(be,{size:12,className:"text-zinc-400"});return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-900/50",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-800",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-zinc-500 tracking-widest flex items-center gap-2 mb-4",children:[e.jsx(xt,{size:14})," Library"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{icon:oe,label:"Rect",action:()=>p("rect")},{icon:ie,label:"Circle",action:()=>p("circle")},{icon:be,label:"Text",action:f},{icon:ce,label:"Image",action:d}].map((r,j)=>e.jsxs("button",{onClick:r.action,className:"flex flex-col items-center justify-center p-3 rounded-lg border border-zinc-800 bg-zinc-950 hover:bg-zinc-800 hover:border-zinc-700 transition-all text-zinc-400 group",children:[e.jsx(r.icon,{size:18,className:"group-hover:text-zinc-200"}),e.jsx("span",{className:"text-[8px] font-bold mt-1.5 uppercase tracking-tighter",children:r.label})]},j))})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between border-b border-zinc-800 bg-zinc-900/30",children:[e.jsxs("span",{className:"text-[10px] font-black uppercase text-zinc-500 tracking-widest flex items-center gap-2",children:[e.jsx(le,{size:14})," Layers"]}),e.jsx("span",{className:"text-[9px] font-mono text-zinc-600",children:Object.keys(a||{}).length})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-0.5",children:[a&&Object.entries(a).reverse().map(([r,j])=>e.jsxs("button",{onClick:()=>o(r),className:`w-full flex items-center gap-3 px-3 py-2 rounded-md transition-all group ${s===r?"bg-indigo-500/10 border border-indigo-500/30":"bg-transparent border border-transparent hover:bg-zinc-800"}`,children:[e.jsx("div",{className:"opacity-60 group-hover:opacity-100",children:v(r,j.type)}),e.jsxs("div",{className:"flex flex-col items-start overflow-hidden",children:[e.jsx("span",{className:`text-[11px] font-medium truncate w-full ${s===r?"text-indigo-400":"text-zinc-400"}`,children:r.replace(/_/g," ")}),e.jsxs("span",{className:"text-[8px] font-mono text-zinc-600",children:[Math.round(j.x),", ",Math.round(j.y)]})]})]},r)),(!a||Object.keys(a).length===0)&&e.jsxs("div",{className:"py-10 text-center opacity-20",children:[e.jsx(le,{size:24,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-tight",children:"Empty Layer List"})]})]})]})]})},W=({label:a,children:s})=>e.jsxs("div",{className:"space-y-2 border-b border-zinc-800 pb-4 last:border-0",children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase tracking-tight",children:a}),s]}),Gt=({selectedId:a,config:s,onUpdate:o,onDelete:p,onMoveLayer:f,isTextLayer:d})=>{if(!a||!s)return e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center opacity-30 p-8",children:[e.jsx(we,{size:48,strokeWidth:1,className:"text-zinc-500 mb-4"}),e.jsx("p",{className:"text-xs font-medium uppercase tracking-widest text-zinc-500",children:"No Selection"}),e.jsx("p",{className:"text-[10px] text-zinc-600 mt-2",children:"Click on the canvas or layers to edit properties."})]});const v=d(a)||s.type==="text";return e.jsxs("div",{className:"flex flex-col gap-5 h-full",children:[e.jsx(W,{label:"Arrangement",children:e.jsxs("div",{className:"flex gap-1 bg-zinc-950 p-1 rounded-lg border border-zinc-800",children:[e.jsx("button",{onClick:()=>f("top"),title:"To Front",className:"flex-1 flex items-center justify-center p-2 hover:bg-zinc-800 text-zinc-400 rounded-md transition-colors",children:e.jsx(dt,{size:14})}),e.jsx("button",{onClick:()=>f("up"),title:"Forward",className:"flex-1 flex items-center justify-center p-2 hover:bg-zinc-800 text-zinc-400 rounded-md transition-colors",children:e.jsx(tt,{size:14})}),e.jsx("button",{onClick:()=>f("down"),title:"Backward",className:"flex-1 flex items-center justify-center p-2 hover:bg-zinc-800 text-zinc-400 rounded-md transition-colors",children:e.jsx(ct,{size:14})}),e.jsx("button",{onClick:()=>f("bottom"),title:"To Back",className:"flex-1 flex items-center justify-center p-2 hover:bg-zinc-800 text-zinc-400 rounded-md transition-colors",children:e.jsx(ot,{size:14})}),e.jsx("div",{className:"w-[1px] bg-zinc-800 mx-1"}),e.jsx("button",{onClick:()=>o(a,{locked:!s.locked}),className:`flex-1 flex items-center justify-center p-2 rounded-md transition-all ${s.locked?"bg-orange-500/20 text-orange-400 border border-orange-500/50":"text-zinc-400 hover:bg-zinc-800"}`,children:s.locked?e.jsx(Pe,{size:14}):e.jsx(jt,{size:14})})]})}),e.jsx(W,{label:"Dimensions",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-zinc-950 border border-zinc-800 rounded-lg p-2",children:[e.jsx("span",{className:"text-[8px] text-zinc-600 font-bold block mb-1",children:"WIDTH (W)"}),e.jsx("input",{type:"number",value:Math.round(s.width||0),onChange:r=>o(a,{width:parseInt(r.target.value)}),className:"w-full bg-transparent text-xs font-mono outline-none text-zinc-200"})]}),e.jsxs("div",{className:"bg-zinc-950 border border-zinc-800 rounded-lg p-2",children:[e.jsx("span",{className:"text-[8px] text-zinc-600 font-bold block mb-1",children:"HEIGHT (H)"}),e.jsx("input",{type:"number",value:Math.round(s.height||0),onChange:r=>o(a,{height:parseInt(r.target.value)}),className:"w-full bg-transparent text-xs font-mono outline-none text-zinc-200"})]}),e.jsxs("div",{className:"bg-zinc-950 border border-zinc-800 rounded-lg p-2",children:[e.jsx("span",{className:"text-[8px] text-zinc-600 font-bold block mb-1",children:"ROTATION (°)"}),e.jsx("input",{type:"number",value:s.rotation||0,onChange:r=>o(a,{rotation:parseInt(r.target.value)}),className:"w-full bg-transparent text-xs font-mono outline-none text-zinc-200"})]}),e.jsxs("div",{className:"bg-zinc-950 border border-zinc-800 rounded-lg p-2",children:[e.jsx("span",{className:"text-[8px] text-zinc-600 font-bold block mb-1",children:"FILL COLOR"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:s.fill||"#000000",onChange:r=>o(a,{fill:r.target.value}),className:"w-4 h-4 rounded-full bg-transparent cursor-pointer border-none overflow-hidden"}),e.jsx("span",{className:"text-[9px] font-mono uppercase text-zinc-400",children:s.fill||"#000000"})]})]})]})}),v&&e.jsxs(e.Fragment,{children:[e.jsx(W,{label:"Content",children:e.jsx("textarea",{value:s.text||"",onChange:r=>o(a,{text:r.target.value}),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg p-2 text-xs text-zinc-200 outline-none focus:border-indigo-500/50 h-16 resize-none",placeholder:"Enter text..."})}),e.jsx(W,{label:`Font Size: ${s.fontSize||18}px`,children:e.jsx("input",{type:"range",min:"8",max:"100",value:s.fontSize||18,onChange:r=>o(a,{fontSize:parseInt(r.target.value)}),className:"w-full h-1 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500"})}),e.jsx(W,{label:"Fit Mode",children:e.jsx("div",{className:"grid grid-cols-2 gap-1 bg-zinc-950 p-1 rounded-lg border border-zinc-800",children:["none","wrap","shrink","stretch"].map(r=>e.jsx("button",{onClick:()=>o(a,{fit:r}),className:`px-2 py-1.5 text-[8px] uppercase font-bold rounded-md transition-all ${s.fit===r?"bg-indigo-500 text-white":"text-zinc-500 hover:text-zinc-300"}`,children:r},r))})}),s.fit==="shrink"&&e.jsx(W,{label:`Max Lines: ${s.maxLines||1}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"1",max:"10",value:s.maxLines||1,onChange:r=>o(a,{maxLines:parseInt(r.target.value)}),className:"flex-1 h-1 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500"}),e.jsx("input",{type:"number",min:"1",max:"10",value:s.maxLines||1,onChange:r=>o(a,{maxLines:parseInt(r.target.value)}),className:"w-10 bg-zinc-950 border border-zinc-800 rounded p-1 text-[10px] text-center font-mono text-zinc-200 outline-none"})]})})]}),e.jsx(W,{label:`Opacity: ${Math.round((s.opacity??1)*100)}%`,children:e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:s.opacity??1,onChange:r=>o(a,{opacity:parseFloat(r.target.value)}),className:"w-full h-1 bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500"})}),e.jsx("div",{className:"pt-4 mt-auto",children:e.jsxs("button",{onClick:p,className:"w-full py-2.5 text-xs font-bold text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-md border border-transparent hover:border-red-500/20 flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Ye,{size:14})," Delete Layer"]})})]})},Bt=({id:a,config:s,isSelected:o,zoom:p,previewText:f,image:d,anyItemSelected:v,onDragMove:r,onDragEnd:j,onSelect:h,onUpdate:i})=>{const m=a==="photo",E=a==="signature",R=a.startsWith("img")||s.type==="image",q=a.startsWith("rect")||a.startsWith("circle")||s.type==="rect"||s.type==="circle",[H]=X(R&&!m&&!E&&s.src||"","anonymous"),S=m||E?d:H,Z=()=>!s.locked,V="#6366f1",L={name:a,x:s.x,y:s.y,rotation:s.rotation||0,opacity:s.opacity??1,draggable:o&&!s.locked,listening:Z(),onClick:k=>{k.cancelBubble=!0,h(a)},onTap:k=>{k.cancelBubble=!0,h(a)},onDragMove:r,onDragEnd:j};if(m||E||R||q){const k=s.width||100,T=s.height||100;return e.jsxs(me,{...L,width:k,height:T,children:[e.jsx(re,{name:"Bounds",width:k,height:T,stroke:V,strokeWidth:1.5/p,opacity:o?1:0,listening:!1}),(m||E||R)&&S&&e.jsx(ze,{name:"Image",image:S,width:k,height:T,sceneFunc:(I,$)=>{const F=$.width(),G=$.height(),B=Math.min(F/S.width,G/S.height),ne=(F-S.width*B)/2,J=(G-S.height*B)/2;I.drawImage(S,ne,J,S.width*B,S.height*B)}}),q&&(s.type==="circle"?e.jsx(Fe,{name:"Shape",x:k/2,y:T/2,radius:k/2,fill:s.fill||"#6366f1"}):e.jsx(re,{name:"Shape",width:k,height:T,fill:s.fill||"#6366f1",cornerRadius:s.radius||0}))]})}const K=f||s.text||`${a}`,{fontSize:Y,wrap:de}=Je(s,K),P=s.width||200,A=s.fit==="none"?void 0:s.height||40;return e.jsxs(me,{...L,width:P,height:A,children:[e.jsx(re,{name:"Bounds",width:P,height:A||20,stroke:V,strokeWidth:1/p,dash:[4,2],opacity:o?.8:0,listening:!1}),e.jsx(Ge,{name:"Text",text:K,fontSize:Y,width:P,height:A,fontFamily:s.fontFamily||"Arial",fontStyle:s.fontStyle||"bold",fill:s.fill||"#1e293b",align:s.align||"center",verticalAlign:"middle",wrap:de,ellipsis:s.overflow==="ellipsis"})]})},je="https://dashboard-ncnian-id.svizcarra.online",ye=5,Ut=({zoom:a})=>e.jsx("div",{className:"h-6 w-full bg-zinc-900 border-b border-zinc-800 relative overflow-hidden flex text-[9px] text-zinc-500 font-mono select-none",children:Array.from({length:40}).map((s,o)=>e.jsx("div",{className:"absolute bottom-0 border-l border-zinc-700 h-2",style:{left:o*50*a},children:o>0&&e.jsx("span",{className:"absolute -top-4 -left-2",children:o*50})},o))}),qt=({zoom:a})=>e.jsx("div",{className:"w-6 h-full bg-zinc-900 border-r border-zinc-800 relative overflow-hidden flex flex-col text-[9px] text-zinc-500 font-mono select-none",children:Array.from({length:60}).map((s,o)=>e.jsx("div",{className:"absolute right-0 border-t border-zinc-700 w-2",style:{top:o*50*a},children:o>0&&e.jsx("span",{className:"absolute -left-5 -top-2 w-4 text-right",children:o*50})},o))}),_=({icon:a,label:s,active:o,onClick:p,disabled:f})=>e.jsx("button",{onClick:p,disabled:f,title:s,className:`p-2 rounded-lg transition-all flex items-center justify-center ${o?"bg-indigo-500/20 text-indigo-400 border border-indigo-500/50":"text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200 border border-transparent"} ${f?"opacity-50 cursor-not-allowed":""}`,children:e.jsx(a,{size:18,strokeWidth:2})}),Ht=({templateId:a,templateName:s,onSave:o,currentLayout:p,allStudents:f})=>{const[d,v]=u.useState("FRONT"),[r,j]=u.useState(p),[h,i]=u.useState(null),[m,E]=u.useState(Be),[R,q]=u.useState(!1),[H,S]=u.useState(!0),[Z,V]=u.useState("select"),[L,K]=u.useState(!0),[Y,de]=u.useState(!0),[P,A]=u.useState({vertical:[],horizontal:[]}),[k,T]=u.useState(!1),I=u.useRef(null),$=u.useRef(null),F=u.useRef(null),G=u.useRef(null),[B]=X(Wt),[ne]=X(Pt);u.useEffect(()=>{p&&j(p)},[p]);const J=t=>{if(!t)return"";if(t.startsWith("http")||t.startsWith("data:")||t.startsWith("blob:"))return t;const n=t.replace(`${je}/storage/`,"");return`${je}/api/proxy-image?path=${encodeURIComponent(n)}`},C=u.useMemo(()=>f?.length?[...f].sort((t,n)=>new Date(n.updated_at||n.created_at).getTime()-new Date(t.updated_at||t.created_at).getTime())[0]:null,[f]),Q=u.useMemo(()=>C?{fullName:`${C.first_name} ${C.last_name}`,idNumber:C.id_number,course:s||C.course||"COURSE",photo:J(C.id_picture),signature:J(C.signature_picture),guardian_name:C.guardian_name,guardian_contact:C.guardian_contact,address:C.address}:null,[C,s]),[Se]=X(Q?.photo||"","anonymous"),[Ce]=X(Q?.signature||"","anonymous"),ee=(t,n)=>{const l=d.toLowerCase();j(c=>({...c,[l]:{...c[l],[t]:{...c[l][t],...n}}}))},_e=t=>{const n=[0,D/2,D],l=[0,O/2,O];return F.current.children.forEach(c=>{if(c===t||c.name()==="background"||c.getClassName()==="Transformer"||c.getClassName()==="Line")return;const x=c.x(),b=c.y(),w=c.width(),g=c.height();n.push(x,x+w,x+w/2),l.push(b,b+g,b+g/2)}),{vertical:Array.from(new Set(n)),horizontal:Array.from(new Set(l))}},Me=t=>{const n=t.x(),l=t.y(),c=t.width(),x=t.height();return{vertical:[{guide:n,offset:0,snap:"start"},{guide:n+c/2,offset:-c/2,snap:"center"},{guide:n+c,offset:-c,snap:"end"}],horizontal:[{guide:l,offset:0,snap:"start"},{guide:l+x/2,offset:-x/2,snap:"center"},{guide:l+x,offset:-x,snap:"end"}]}},Le=t=>{if(!L||k)return;const n=t.target,l=_e(n),c=Me(n),x=[],b=[];l.vertical.forEach(g=>{c.vertical.forEach(N=>{const z=Math.abs(g-N.guide);z<ye&&x.push({line:g,diff:z,offset:N.offset})})}),l.horizontal.forEach(g=>{c.horizontal.forEach(N=>{const z=Math.abs(g-N.guide);z<ye&&b.push({line:g,diff:z,offset:N.offset})})});const w={vertical:[],horizontal:[]};if(x.length>0){const g=x.sort((N,z)=>N.diff-z.diff)[0];n.x(g.line+g.offset),w.vertical.push(g.line)}if(b.length>0){const g=b.sort((N,z)=>N.diff-z.diff)[0];n.y(g.line+g.offset),w.horizontal.push(g.line)}A(w)},ae=t=>{const n=d.toLowerCase(),l=`${t}_${Date.now()}`,c={x:50,y:50,width:100,height:100,fill:"#6366f1",rotation:0,opacity:1,type:t,fit:"none"};j(x=>({...x,[n]:{...x[n],[l]:c}})),i(l)},Te=()=>{const t=d.toLowerCase(),n=`text_${Date.now()}`,l={type:"text",x:50,y:50,width:200,height:40,text:"New Text",fontSize:20,fill:"#000000",rotation:0,fit:"none"};j(c=>({...c,[t]:{...c[t],[n]:l}})),i(n)},$e=t=>{const n=t.target.files?.[0];if(!n)return;const l=new FileReader;l.onload=c=>{const x=c.target?.result,b=new Image;b.onload=()=>{const w=d.toLowerCase(),g=`img_${Date.now()}`,N=b.height/b.width,z=Math.min(D*.4,200),U=z*N,Oe={type:"image",src:x,x:(D-z)/2,y:(O-U)/2,width:Math.round(z),height:Math.round(U),opacity:1,rotation:0};j(pe=>({...pe,[w]:{...pe[w],[g]:Oe}})),i(g),M.success("Image uploaded")},b.src=x},l.readAsDataURL(n),t.target.value=""},De=()=>{if(!h)return;const t=d.toLowerCase(),n={...r};delete n[t][h],j(n),i(null)},Ee=t=>{h&&j(n=>({...n,[d.toLowerCase()]:et(n[d.toLowerCase()],h,t)}))},he=()=>T(!0),xe=t=>{const n=t.target,l=n.scaleX(),c=n.scaleY(),x=Math.max(10,n.width()*l),b=Math.max(10,n.height()*c);n.setAttrs({width:x,height:b,scaleX:1,scaleY:1});const w=n.findOne("Text"),g=n.findOne("Image"),N=n.findOne(".Shape"),z=n.findOne(".Bounds");if(w&&(w.width(x),w.height(b)),g&&(g.width(x),g.height(b)),z&&(z.width(x),z.height(b)),N)if(N.getClassName()==="Circle"){const U=x/2;N.setAttrs({radius:U,x:U,y:U})}else N.setAttrs({width:x,height:b});F.current?.batchDraw()},ue=t=>{T(!1);const n=t.target,l=n.name();if(!l)return;const c=n.findOne("Text"),x=d.toLowerCase(),b=r[x]?.[l],w={x:Math.round(n.x()),y:Math.round(n.y()),width:Math.round(n.width()),height:Math.round(n.height()),rotation:Math.round(n.rotation())};c&&b?.fit==="stretch"&&(w.fontSize=Math.round(c.fontSize())),A({vertical:[],horizontal:[]}),ee(l,w)};u.useEffect(()=>{if(!$.current)return;const t=$.current;return t.on("transformstart",he),t.on("transform",xe),t.on("transformend",ue),()=>{t.off("transformstart",he),t.off("transform",xe),t.off("transformend",ue)}},[r,d]);const Re=async()=>{if(!a)return M.error("Select a template");q(!0);try{const t=async x=>(v(x),await new Promise(b=>setTimeout(b,150)),I.current?.toDataURL({pixelRatio:ge})),n=await t("FRONT"),l=await t("BACK"),c={...r,previewImages:{front:n,back:l}};await It(a,s,c),o(c),v("FRONT"),M.success("Changes saved!")}catch(t){console.error(t),M.error("Save failed")}finally{q(!1)}},Ae=()=>{I.current&&(i(null),setTimeout(()=>{const t=I.current.toDataURL({pixelRatio:ge}),n=document.createElement("a");n.download=`${Q?.idNumber||"ID"}_${d}.png`,n.href=t,n.click()},50))};u.useEffect(()=>{const t=I.current.findOne("."+h);t?$.current.nodes([t]):$.current.nodes([])},[h,d]);const Ie=t=>!["photo","signature"].includes(t)&&!t.startsWith("rect")&&!t.startsWith("circle")&&!t.startsWith("img"),te=r[d.toLowerCase()]||{};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-950 text-zinc-200 overflow-hidden font-sans border border-zinc-800 shadow-2xl select-none",children:[e.jsx("input",{type:"file",ref:G,className:"hidden",accept:"image/*",onChange:$e}),e.jsxs("div",{className:"h-12 border-b border-zinc-800 bg-zinc-900 flex items-center justify-between px-4 z-20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400",children:[e.jsx("span",{children:"Project"}),e.jsx(Ue,{size:12}),e.jsx("span",{className:"text-zinc-100 font-medium",children:s})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-zinc-800 p-0.5 rounded-lg border border-zinc-700",children:[e.jsx(_,{icon:wt,onClick:()=>E(t=>Math.max(qe,t-.1)),label:"Zoom Out"}),e.jsxs("span",{className:"text-[10px] w-10 text-center font-mono text-zinc-400",children:[Math.round(m*100),"%"]}),e.jsx(_,{icon:ke,onClick:()=>E(t=>Math.min(He,t+.1)),label:"Zoom In"}),e.jsx("div",{className:"w-px h-4 bg-zinc-700 mx-1"}),e.jsx(_,{icon:vt,active:L,onClick:()=>K(!L),label:`Snapping ${L?"ON":"OFF"}`})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Re,disabled:R,className:"flex items-center gap-2 px-4 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-md text-xs font-semibold transition-all",children:[R?e.jsx(st,{size:14,className:"animate-spin"}):e.jsx($t,{size:14}),R?"Saving...":"Save Changes"]}),e.jsx(_,{icon:nt,onClick:Ae,label:"Export"})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-12 border-r border-zinc-800 bg-zinc-900 flex flex-col items-center py-4 gap-3 z-20",children:[e.jsx(_,{icon:we,active:Z==="select",onClick:()=>V("select"),label:"Select"}),e.jsx(_,{icon:St,active:Z==="hand",onClick:()=>V("hand"),label:"Pan"}),e.jsx("div",{className:"w-4 h-px bg-zinc-800"}),e.jsx(_,{icon:oe,onClick:()=>ae("rect"),label:"Rectangle"}),e.jsx(_,{icon:ie,onClick:()=>ae("circle"),label:"Circle"}),e.jsx(_,{icon:ce,onClick:()=>G.current?.click(),label:"Upload Image"})]}),e.jsxs("div",{className:"w-64 border-r border-zinc-800 bg-zinc-900/50 flex flex-col z-10",children:[e.jsx("div",{className:"p-4 border-b border-zinc-800",children:e.jsx("div",{className:"flex bg-zinc-950 p-1 rounded-lg border border-zinc-800",children:["FRONT","BACK"].map(t=>e.jsxs("button",{onClick:()=>{v(t),i(null)},className:`flex-1 py-1.5 rounded-md text-[10px] font-bold transition-all ${d===t?"bg-zinc-800 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"}`,children:[t," SIDE"]},t))})}),e.jsx(Ft,{layers:te,selectedId:h,onSelect:i,onAddShape:ae,onAddText:Te,onUploadImage:()=>G.current?.click()})]}),e.jsxs("div",{className:"flex-1 relative bg-[#18181b] flex flex-col overflow-hidden",children:[e.jsx("div",{className:"h-10 border-b border-zinc-800 bg-zinc-900 flex items-center justify-between px-4 z-10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{icon:mt,active:H,onClick:()=>S(!H),label:"Toggle Grid"}),e.jsx("div",{className:"w-px h-4 bg-zinc-800 mx-2"}),e.jsxs("span",{className:"text-[10px] text-zinc-500 uppercase font-bold",children:["Canvas: ",D," × ",O,"px"]})]})}),e.jsxs("div",{className:"flex-1 flex relative overflow-auto",children:[e.jsx(qt,{zoom:m}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx(Ut,{zoom:m}),e.jsxs("div",{className:"flex-1 overflow-auto bg-[#18181b] flex items-center justify-center p-12 relative",children:[H&&e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-[0.03]",style:{backgroundImage:"radial-gradient(#fff 1px, transparent 1px)",backgroundSize:`${20*m}px ${20*m}px`}}),e.jsx("div",{className:"shadow-2xl bg-white relative",style:{width:D*m,height:O*m},children:e.jsx(Ve,{ref:I,width:D*m,height:O*m,scaleX:m,scaleY:m,onMouseDown:t=>t.target===t.target.getStage()&&i(null),children:e.jsxs(Xe,{ref:F,children:[e.jsx(ze,{name:"background",image:d==="FRONT"?B:ne,width:D,height:O,listening:!1}),Object.entries(te).map(([t,n])=>e.jsx(Bt,{id:t,config:n,isSelected:h===t,zoom:m,image:t==="photo"?Se:t==="signature"?Ce:void 0,previewText:Q?.[t]||(t==="course"?s:void 0),onSelect:i,onUpdate:ee,onDragMove:Le,onDragEnd:l=>{ee(t,{x:Math.round(l.target.x()),y:Math.round(l.target.y())}),A({vertical:[],horizontal:[]})},anyItemSelected:!!h},t)),L&&Y&&P.vertical.map((t,n)=>e.jsx(fe,{points:[t,-5e3,t,5e3],stroke:"#ff6b6b",strokeWidth:1/m,dash:[5,5],listening:!1},`v-${n}`)),L&&Y&&P.horizontal.map((t,n)=>e.jsx(fe,{points:[-5e3,t,5e3,t],stroke:"#ff6b6b",strokeWidth:1/m,dash:[5,5],listening:!1},`h-${n}`)),e.jsx(Ze,{ref:$,rotateEnabled:!0,enabledAnchors:Qe(h?te[h]:null),keepRatio:h?["photo","signature"].includes(h)||h.startsWith("img")||h.startsWith("circle"):!1,anchorSize:10,anchorCornerRadius:3.5,borderStrokeWidth:2,anchorStroke:"teal",borderStroke:"white",boundBoxFunc:(t,n)=>Math.abs(n.width)<10||Math.abs(n.height)<10?t:n})]})})})]})]})]})]}),e.jsxs("div",{className:"w-72 border-l border-zinc-800 bg-zinc-900 p-6 flex flex-col gap-6 overflow-y-auto",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-zinc-500 tracking-widest",children:"Properties"}),e.jsx(Gt,{selectedId:h,config:h?te[h]:null,onUpdate:ee,onDelete:De,onMoveLayer:Ee,isTextLayer:Ie})]})]})]})},Vt=({selectedTemplate:a,setSelectedTemplate:s,saveCount:o,setSaveCount:p,allStudents:f})=>e.jsxs("div",{className:"flex h-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-xl overflow-hidden",children:[e.jsx("div",{className:"w-46 border-r border-slate-100 dark:border-slate-800 shrink-0",children:e.jsx(Ot,{activeId:a?.id,onSelect:d=>s(d),refreshTrigger:o})}),e.jsx("div",{className:"flex-1 relative min-w-0 bg-zinc-950",children:a?e.jsx(Ht,{templateId:a.id,templateName:a.name,currentLayout:{front:{...a.front_config},back:{...a.back_config}},allStudents:f,onSave:d=>{s(v=>({...v,front_config:d.front,back_config:d.back})),p(v=>v+1)}}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-zinc-900",children:[e.jsx("div",{className:"p-8 rounded-full bg-zinc-800 mb-4 text-zinc-600",children:e.jsx(Ne,{size:48,strokeWidth:1})}),e.jsx("p",{className:"text-zinc-500 font-bold uppercase tracking-widest text-xs",children:"Select a template to begin designing"})]})})]}),ts=()=>{console.log("DEBUG: CardDesignerPage MOUNTED");const[a,s]=u.useState(null),[o,p]=u.useState(0),[f,d]=u.useState([]),[v,r]=u.useState(!0);return u.useEffect(()=>{(async()=>{try{console.log("DEBUG: Starting API call to getStudents..."),r(!0);const h=await at();console.log("DEBUG: API Response Received:",h);const i=[...h.queueList||[],...h.history||[]];console.log(`DEBUG: Total students combined for preview: ${i.length}`),i.length>0&&console.log("DEBUG: Sample student from API:",i[0]),d(i)}catch(h){console.error("DEBUG: Designer Load Error:",h),M.error("Failed to load student records for preview")}finally{r(!1)}})()},[]),v?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-zinc-950",children:[e.jsx(ve,{className:"animate-spin text-teal-500 mb-4",size:40}),e.jsx("p",{className:"text-zinc-500 font-black uppercase tracking-widest text-[10px]",children:"Initializing..."})]}):e.jsx("div",{className:"h-full",children:e.jsx(Vt,{selectedTemplate:a,setSelectedTemplate:s,saveCount:o,setSaveCount:p,allStudents:f})})};export{ts as default};
